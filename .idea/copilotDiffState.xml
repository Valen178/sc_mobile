<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/sportconnection/ProfileFormActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/sportconnection/ProfileFormActivity.java" />
              <option name="originalContent" value="package com.example.sportconnection;&#10;&#10;import android.app.DatePickerDialog;&#10;import android.content.Intent;&#10;import android.os.Bundle;&#10;import android.util.Log;&#10;import android.view.View;&#10;import android.widget.AdapterView;&#10;import android.widget.ArrayAdapter;&#10;import android.widget.Button;&#10;import android.widget.DatePicker;&#10;import android.widget.EditText;&#10;import android.widget.Spinner;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;&#10;import androidx.activity.EdgeToEdge;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;&#10;import java.text.SimpleDateFormat;&#10;import java.util.Calendar;&#10;import java.util.Locale;&#10;&#10;import com.example.sportconnection.model.Location;&#10;import com.example.sportconnection.model.ProfileRequest;&#10;import com.example.sportconnection.model.ProfileResponse;&#10;import com.example.sportconnection.model.GetProfileResponse;&#10;import com.example.sportconnection.model.UpdateProfileRequest;&#10;import com.example.sportconnection.model.Sport;&#10;import com.example.sportconnection.repository.AuthRepository;&#10;import com.example.sportconnection.repository.LookupRepository;&#10;import com.example.sportconnection.utils.LoadingDialog;&#10;import com.example.sportconnection.utils.SessionManager;&#10;import com.example.sportconnection.utils.ThreadManager;&#10;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class ProfileFormActivity extends AppCompatActivity {&#10;&#10;    private static final String TAG = &quot;ProfileFormActivity&quot;;&#10;&#10;    private TextView titleProfileForm;&#10;    private EditText editTextName, editTextLastName, editTextBirthdate;&#10;    private EditText editTextHeight, editTextWeight;&#10;    private Spinner spinnerLocation, spinnerSport;&#10;    private EditText editTextPhone, editTextInstagram;&#10;    private EditText editTextTwitter, editTextDescription, editTextAgency;&#10;    private Button buttonComplete;&#10;&#10;    private String email, password, profileType, token;&#10;    private int userId;&#10;&#10;    // Variables para modo edición&#10;    private boolean isEditMode = false;&#10;    private int profileId = -1;&#10;    private GetProfileResponse.ProfileData currentProfile;&#10;&#10;    private AuthRepository authRepository;&#10;    private LookupRepository lookupRepository;&#10;    private SessionManager sessionManager;&#10;    private LoadingDialog loadingDialog;&#10;    private ThreadManager threadManager;&#10;&#10;    private List&lt;Sport&gt; sportList = new ArrayList&lt;&gt;();&#10;    private List&lt;Location&gt; locationList = new ArrayList&lt;&gt;();&#10;    private int selectedSportId = -1;&#10;    private int selectedLocationId = -1;&#10;&#10;    private String selectedBirthdate = &quot;&quot;; // Formato ISO: YYYY-MM-DD&#10;    private Calendar birthdateCalendar = Calendar.getInstance();&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        EdgeToEdge.enable(this);&#10;        setContentView(R.layout.activity_profile_form);&#10;&#10;        // Obtener datos del Intent&#10;        isEditMode = getIntent().getBooleanExtra(&quot;isEditMode&quot;, false);&#10;&#10;        if (isEditMode) {&#10;            // Modo edición - obtener desde sesión o intent&#10;            sessionManager = new SessionManager(this);&#10;            token = sessionManager.getToken();&#10;            userId = sessionManager.getUserId();&#10;            email = sessionManager.getEmail();&#10;            &#10;            // Intentar obtener profileType del intent primero (más confiable), si no, de la sesión&#10;            profileType = getIntent().getStringExtra(&quot;profileType&quot;);&#10;            if (profileType == null) {&#10;                profileType = sessionManager.getProfileType();&#10;                Log.d(TAG, &quot;onCreate: ProfileType obtenido de sesión: &quot; + profileType);&#10;            } else {&#10;                Log.d(TAG, &quot;onCreate: ProfileType obtenido de intent: &quot; + profileType);&#10;            }&#10;&#10;            Log.d(TAG, &quot;onCreate: Modo EDICIÓN - profileType=&quot; + profileType);&#10;        } else {&#10;            // Modo creación - obtener desde intent&#10;            email = getIntent().getStringExtra(&quot;email&quot;);&#10;            password = getIntent().getStringExtra(&quot;password&quot;);&#10;            profileType = getIntent().getStringExtra(&quot;profileType&quot;);&#10;            token = getIntent().getStringExtra(&quot;token&quot;);&#10;            userId = getIntent().getIntExtra(&quot;userId&quot;, -1);&#10;&#10;            Log.d(TAG, &quot;onCreate: Modo CREACIÓN - profileType=&quot; + profileType + &quot;, userId=&quot; + userId);&#10;        }&#10;&#10;        // Inicializar vistas&#10;        titleProfileForm = findViewById(R.id.titleProfileForm);&#10;        editTextName = findViewById(R.id.editTextName);&#10;        editTextLastName = findViewById(R.id.editTextLastName);&#10;        editTextBirthdate = findViewById(R.id.editTextBirthdate);&#10;        editTextHeight = findViewById(R.id.editTextHeight);&#10;        editTextWeight = findViewById(R.id.editTextWeight);&#10;        spinnerLocation = findViewById(R.id.spinnerLocation);&#10;        spinnerSport = findViewById(R.id.spinnerSport);&#10;        editTextPhone = findViewById(R.id.editTextPhone);&#10;        editTextInstagram = findViewById(R.id.editTextInstagram);&#10;        editTextTwitter = findViewById(R.id.editTextTwitter);&#10;        editTextDescription = findViewById(R.id.editTextDescription);&#10;        editTextAgency = findViewById(R.id.editTextAgency);&#10;        buttonComplete = findViewById(R.id.buttonComplete);&#10;&#10;        // Inicializar repositorios y utilidades&#10;        authRepository = new AuthRepository();&#10;        lookupRepository = new LookupRepository();&#10;        if (sessionManager == null) {&#10;            sessionManager = new SessionManager(this);&#10;        }&#10;        loadingDialog = new LoadingDialog(this);&#10;        threadManager = ThreadManager.getInstance();&#10;&#10;        // Configurar el formulario según el tipo de perfil&#10;        setupFormByProfileType();&#10;&#10;        // Cargar datos de sports y locations&#10;        loadSportsAndLocations();&#10;&#10;        // Configurar el selector de fecha de nacimiento&#10;        setupBirthdatePicker();&#10;&#10;        // Si es modo edición, cargar los datos actuales del perfil&#10;        if (isEditMode) {&#10;            buttonComplete.setText(&quot;Guardar Cambios&quot;);&#10;            loadCurrentProfile();&#10;        }&#10;&#10;        // Configurar el botón de completar/guardar&#10;        buttonComplete.setOnClickListener(new View.OnClickListener() {&#10;            @Override&#10;            public void onClick(View v) {&#10;                if (validateForm()) {&#10;                    if (isEditMode) {&#10;                        updateProfile();&#10;                    } else {&#10;                        completeRegistration();&#10;                    }&#10;                }&#10;            }&#10;        });&#10;    }&#10;&#10;    private void setupFormByProfileType() {&#10;        Log.d(TAG, &quot;setupFormByProfileType: &quot; + profileType);&#10;&#10;        switch (profileType.toLowerCase()) {&#10;            case &quot;athlete&quot;:&#10;                titleProfileForm.setText(&quot;Perfil de Atleta&quot;);&#10;                editTextName.setHint(&quot;Nombre&quot;);&#10;                editTextLastName.setVisibility(View.VISIBLE);&#10;                editTextLastName.setHint(&quot;Apellido&quot;);&#10;                editTextBirthdate.setVisibility(View.VISIBLE);&#10;                editTextHeight.setVisibility(View.VISIBLE);&#10;                editTextWeight.setVisibility(View.VISIBLE);&#10;                editTextAgency.setVisibility(View.GONE);&#10;                break;&#10;&#10;            case &quot;agent&quot;:&#10;                titleProfileForm.setText(&quot;Perfil de Agente&quot;);&#10;                editTextName.setHint(&quot;Nombre&quot;);&#10;                editTextLastName.setVisibility(View.VISIBLE);&#10;                editTextLastName.setHint(&quot;Apellido&quot;);&#10;                editTextBirthdate.setVisibility(View.GONE);&#10;                editTextHeight.setVisibility(View.GONE);&#10;                editTextWeight.setVisibility(View.GONE);&#10;                editTextDescription.setHint(&quot;Descripción&quot;);&#10;                editTextAgency.setVisibility(View.VISIBLE);&#10;                break;&#10;&#10;            case &quot;team&quot;:&#10;                titleProfileForm.setText(&quot;Perfil de Equipo&quot;);&#10;                editTextName.setHint(&quot;Nombre del equipo&quot;);&#10;                editTextLastName.setVisibility(View.VISIBLE);&#10;                editTextLastName.setHint(&quot;Puesto/Rol&quot;);&#10;                editTextBirthdate.setVisibility(View.GONE);&#10;                editTextHeight.setVisibility(View.GONE);&#10;                editTextWeight.setVisibility(View.GONE);&#10;                editTextAgency.setVisibility(View.GONE);&#10;                break;&#10;        }&#10;    }&#10;&#10;    private void setupBirthdatePicker() {&#10;        // Configurar fecha máxima (hoy)&#10;        final Calendar maxDate = Calendar.getInstance();&#10;&#10;        // Configurar fecha mínima (40 años atrás)&#10;        final Calendar minDate = Calendar.getInstance();&#10;        minDate.add(Calendar.YEAR, -40);&#10;&#10;        // Configurar fecha inicial (18 años atrás, edad mínima típica)&#10;        birthdateCalendar.add(Calendar.YEAR, -18);&#10;&#10;        editTextBirthdate.setOnClickListener(new View.OnClickListener() {&#10;            @Override&#10;            public void onClick(View v) {&#10;                int year = birthdateCalendar.get(Calendar.YEAR);&#10;                int month = birthdateCalendar.get(Calendar.MONTH);&#10;                int day = birthdateCalendar.get(Calendar.DAY_OF_MONTH);&#10;&#10;                DatePickerDialog datePickerDialog = new DatePickerDialog(&#10;                    ProfileFormActivity.this,&#10;                    new DatePickerDialog.OnDateSetListener() {&#10;                        @Override&#10;                        public void onDateSet(DatePicker view, int year, int month, int dayOfMonth) {&#10;                            // Actualizar el calendario con la fecha seleccionada&#10;                            birthdateCalendar.set(Calendar.YEAR, year);&#10;                            birthdateCalendar.set(Calendar.MONTH, month);&#10;                            birthdateCalendar.set(Calendar.DAY_OF_MONTH, dayOfMonth);&#10;&#10;                            // Formato para mostrar al usuario (DD/MM/YYYY)&#10;                            SimpleDateFormat displayFormat = new SimpleDateFormat(&quot;dd/MM/yyyy&quot;, Locale.getDefault());&#10;                            String displayDate = displayFormat.format(birthdateCalendar.getTime());&#10;                            editTextBirthdate.setText(displayDate);&#10;&#10;                            // Formato ISO para enviar al backend (YYYY-MM-DD)&#10;                            SimpleDateFormat isoFormat = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;, Locale.getDefault());&#10;                            selectedBirthdate = isoFormat.format(birthdateCalendar.getTime());&#10;&#10;                            Log.d(TAG, &quot;Fecha seleccionada - Display: &quot; + displayDate + &quot;, ISO: &quot; + selectedBirthdate);&#10;                        }&#10;                    },&#10;                    year, month, day&#10;                );&#10;&#10;                // Configurar fechas límite&#10;                datePickerDialog.getDatePicker().setMaxDate(maxDate.getTimeInMillis());&#10;                datePickerDialog.getDatePicker().setMinDate(minDate.getTimeInMillis());&#10;&#10;                datePickerDialog.show();&#10;            }&#10;        });&#10;    }&#10;&#10;    private void loadSportsAndLocations() {&#10;        Log.d(TAG, &quot;loadSportsAndLocations: Iniciando carga de datos&quot;);&#10;        loadingDialog.show(&quot;Cargando datos...&quot;);&#10;&#10;        // Cargar deportes&#10;        lookupRepository.getSports(new Callback&lt;List&lt;Sport&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;List&lt;Sport&gt;&gt; call, Response&lt;List&lt;Sport&gt;&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    sportList = response.body();&#10;                    Log.d(TAG, &quot;Sports cargados: &quot; + sportList.size());&#10;                    setupSportSpinner();&#10;                    checkIfDataLoaded();&#10;                } else {&#10;                    Log.e(TAG, &quot;Error al cargar sports: &quot; + response.code());&#10;                    runOnUiThread(new Runnable() {&#10;                        @Override&#10;                        public void run() {&#10;                            loadingDialog.dismiss();&#10;                            Toast.makeText(ProfileFormActivity.this,&#10;                                &quot;Error al cargar deportes&quot;, Toast.LENGTH_SHORT).show();&#10;                        }&#10;                    });&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;List&lt;Sport&gt;&gt; call, Throwable t) {&#10;                Log.e(TAG, &quot;Failure al cargar sports: &quot; + t.getMessage());&#10;                runOnUiThread(new Runnable() {&#10;                    @Override&#10;                    public void run() {&#10;                        loadingDialog.dismiss();&#10;                        Toast.makeText(ProfileFormActivity.this,&#10;                            &quot;Error de conexión al cargar deportes&quot;, Toast.LENGTH_SHORT).show();&#10;                    }&#10;                });&#10;            }&#10;        });&#10;&#10;        // Cargar ubicaciones&#10;        lookupRepository.getLocations(new Callback&lt;List&lt;Location&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;List&lt;Location&gt;&gt; call, Response&lt;List&lt;Location&gt;&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    locationList = response.body();&#10;                    Log.d(TAG, &quot;Locations cargadas: &quot; + locationList.size());&#10;                    setupLocationSpinner();&#10;                    checkIfDataLoaded();&#10;                } else {&#10;                    Log.e(TAG, &quot;Error al cargar locations: &quot; + response.code());&#10;                    runOnUiThread(new Runnable() {&#10;                        @Override&#10;                        public void run() {&#10;                            loadingDialog.dismiss();&#10;                            Toast.makeText(ProfileFormActivity.this,&#10;                                &quot;Error al cargar ubicaciones&quot;, Toast.LENGTH_SHORT).show();&#10;                        }&#10;                    });&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;List&lt;Location&gt;&gt; call, Throwable t) {&#10;                Log.e(TAG, &quot;Failure al cargar locations: &quot; + t.getMessage());&#10;                runOnUiThread(new Runnable() {&#10;                    @Override&#10;                    public void run() {&#10;                        loadingDialog.dismiss();&#10;                        Toast.makeText(ProfileFormActivity.this,&#10;                            &quot;Error de conexión al cargar ubicaciones&quot;, Toast.LENGTH_SHORT).show();&#10;                    }&#10;                });&#10;            }&#10;        });&#10;    }&#10;&#10;    private void setupSportSpinner() {&#10;        ArrayAdapter&lt;Sport&gt; adapter = new ArrayAdapter&lt;&gt;(this,&#10;            android.R.layout.simple_spinner_item, sportList);&#10;        adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);&#10;&#10;        runOnUiThread(new Runnable() {&#10;            @Override&#10;            public void run() {&#10;                spinnerSport.setAdapter(adapter);&#10;                spinnerSport.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {&#10;                    @Override&#10;                    public void onItemSelected(AdapterView&lt;?&gt; parent, View view, int position, long id) {&#10;                        selectedSportId = sportList.get(position).getId();&#10;                        Log.d(TAG, &quot;Sport seleccionado: &quot; + sportList.get(position).getName() +&#10;                            &quot; (ID: &quot; + selectedSportId + &quot;)&quot;);&#10;                    }&#10;&#10;                    @Override&#10;                    public void onNothingSelected(AdapterView&lt;?&gt; parent) {&#10;                        selectedSportId = -1;&#10;                    }&#10;                });&#10;            }&#10;        });&#10;    }&#10;&#10;    private void setupLocationSpinner() {&#10;        ArrayAdapter&lt;Location&gt; adapter = new ArrayAdapter&lt;&gt;(this,&#10;            android.R.layout.simple_spinner_item, locationList);&#10;        adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);&#10;&#10;        runOnUiThread(new Runnable() {&#10;            @Override&#10;            public void run() {&#10;                spinnerLocation.setAdapter(adapter);&#10;                spinnerLocation.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {&#10;                    @Override&#10;                    public void onItemSelected(AdapterView&lt;?&gt; parent, View view, int position, long id) {&#10;                        selectedLocationId = locationList.get(position).getId();&#10;                        Log.d(TAG, &quot;Location seleccionada: &quot; + locationList.get(position).toString() +&#10;                            &quot; (ID: &quot; + selectedLocationId + &quot;)&quot;);&#10;                    }&#10;&#10;                    @Override&#10;                    public void onNothingSelected(AdapterView&lt;?&gt; parent) {&#10;                        selectedLocationId = -1;&#10;                    }&#10;                });&#10;            }&#10;        });&#10;    }&#10;&#10;    private void checkIfDataLoaded() {&#10;        if (!sportList.isEmpty() &amp;&amp; !locationList.isEmpty()) {&#10;            runOnUiThread(new Runnable() {&#10;                @Override&#10;                public void run() {&#10;                    loadingDialog.dismiss();&#10;                    Log.d(TAG, &quot;Datos cargados completamente&quot;);&#10;&#10;                    // Si estamos en modo edición y ya tenemos el perfil, llenar el formulario&#10;                    if (isEditMode &amp;&amp; currentProfile != null) {&#10;                        populateFormWithProfileData();&#10;                    }&#10;                }&#10;            });&#10;        }&#10;    }&#10;&#10;    private boolean validateForm() {&#10;        String name = editTextName.getText().toString().trim();&#10;        String phone = editTextPhone.getText().toString().trim();&#10;&#10;        if (name.isEmpty()) {&#10;            Toast.makeText(this, &quot;Por favor, ingresa el nombre&quot;, Toast.LENGTH_SHORT).show();&#10;            return false;&#10;        }&#10;&#10;        if (profileType.equalsIgnoreCase(&quot;athlete&quot;) || profileType.equalsIgnoreCase(&quot;agent&quot;)) {&#10;            String lastName = editTextLastName.getText().toString().trim();&#10;            if (lastName.isEmpty()) {&#10;                Toast.makeText(this, &quot;Por favor, ingresa el apellido&quot;, Toast.LENGTH_SHORT).show();&#10;                return false;&#10;            }&#10;        }&#10;&#10;        if (profileType.equalsIgnoreCase(&quot;athlete&quot;)) {&#10;            String height = editTextHeight.getText().toString().trim();&#10;            String weight = editTextWeight.getText().toString().trim();&#10;&#10;            if (selectedBirthdate.isEmpty()) {&#10;                Toast.makeText(this, &quot;Por favor, selecciona tu fecha de nacimiento&quot;, Toast.LENGTH_SHORT).show();&#10;                return false;&#10;            }&#10;&#10;            if (height.isEmpty() || weight.isEmpty()) {&#10;                Toast.makeText(this, &quot;Por favor, completa todos los campos obligatorios&quot;, Toast.LENGTH_SHORT).show();&#10;                return false;&#10;            }&#10;        }&#10;&#10;        if (profileType.equalsIgnoreCase(&quot;agent&quot;)) {&#10;            String agency = editTextAgency.getText().toString().trim();&#10;        }&#10;&#10;        if (profileType.equalsIgnoreCase(&quot;team&quot;)) {&#10;            String job = editTextLastName.getText().toString().trim();&#10;            if (job.isEmpty()) {&#10;                Toast.makeText(this, &quot;Por favor, ingresa el puesto/rol&quot;, Toast.LENGTH_SHORT).show();&#10;                return false;&#10;            }&#10;        }&#10;&#10;        if (selectedLocationId == -1 || selectedSportId == -1) {&#10;            Toast.makeText(this, &quot;Por favor, selecciona ubicación y deporte&quot;, Toast.LENGTH_SHORT).show();&#10;            return false;&#10;        }&#10;&#10;        if (phone.isEmpty()) {&#10;            Toast.makeText(this, &quot;Por favor, ingresa el número de teléfono&quot;, Toast.LENGTH_SHORT).show();&#10;            return false;&#10;        }&#10;&#10;        return true;&#10;    }&#10;&#10;    private void completeRegistration() {&#10;        Log.d(TAG, &quot;completeRegistration: Iniciando&quot;);&#10;&#10;        // Mostrar diálogo de carga&#10;        loadingDialog.show(&quot;Creando perfil...&quot;);&#10;        buttonComplete.setEnabled(false);&#10;&#10;        // Crear el objeto ProfileRequest en segundo plano&#10;        threadManager.executeInBackground(new Runnable() {&#10;            @Override&#10;            public void run() {&#10;                final ProfileRequest profileRequest = new ProfileRequest();&#10;                profileRequest.setProfileType(profileType.toLowerCase());&#10;                profileRequest.setName(editTextName.getText().toString().trim());&#10;                profileRequest.setDescription(editTextDescription.getText().toString().trim());&#10;                profileRequest.setPhoneNumber(editTextPhone.getText().toString().trim());&#10;                profileRequest.setIgUser(editTextInstagram.getText().toString().trim());&#10;                profileRequest.setxUser(editTextTwitter.getText().toString().trim());&#10;                profileRequest.setLocationId(selectedLocationId);&#10;                profileRequest.setSportId(selectedSportId);&#10;&#10;                Log.d(TAG, &quot;ProfileRequest: profileType=&quot; + profileType.toLowerCase() +&#10;                    &quot;, locationId=&quot; + selectedLocationId + &quot;, sportId=&quot; + selectedSportId);&#10;&#10;                // Campos específicos según el tipo de perfil&#10;                if (profileType.equalsIgnoreCase(&quot;athlete&quot;)) {&#10;                    profileRequest.setLastName(editTextLastName.getText().toString().trim());&#10;                    // Usar la fecha en formato ISO (YYYY-MM-DD)&#10;                    profileRequest.setBirthdate(selectedBirthdate);&#10;                    profileRequest.setHeight(editTextHeight.getText().toString().trim());&#10;                    profileRequest.setWeight(editTextWeight.getText().toString().trim());&#10;&#10;                    Log.d(TAG, &quot;Athlete profile - Birthdate ISO: &quot; + selectedBirthdate);&#10;                } else if (profileType.equalsIgnoreCase(&quot;agent&quot;)) {&#10;                    profileRequest.setLastName(editTextLastName.getText().toString().trim());&#10;                    profileRequest.setAgency(editTextAgency.getText().toString().trim());&#10;                } else if (profileType.equalsIgnoreCase(&quot;team&quot;)) {&#10;                    profileRequest.setJob(editTextLastName.getText().toString().trim());&#10;                }&#10;&#10;                // Enviar al backend&#10;                authRepository.createProfile(token, profileRequest, new Callback&lt;ProfileResponse&gt;() {&#10;                    @Override&#10;                    public void onResponse(Call&lt;ProfileResponse&gt; call, Response&lt;ProfileResponse&gt; response) {&#10;                        threadManager.executeOnMainThread(new Runnable() {&#10;                            @Override&#10;                            public void run() {&#10;                                loadingDialog.dismiss();&#10;                                buttonComplete.setEnabled(true);&#10;&#10;                                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                                    // Si la respuesta HTTP es exitosa (200-299), el perfil se creó correctamente&#10;                                    Log.d(TAG, &quot;Perfil creado exitosamente - Status: &quot; + response.code());&#10;&#10;                                    // Guardar la sesión en segundo plano&#10;                                    threadManager.executeInBackground(new Runnable() {&#10;                                        @Override&#10;                                        public void run() {&#10;                                            sessionManager.saveSession(token, userId, email, profileType);&#10;&#10;                                            // Navegar en el hilo principal&#10;                                            threadManager.executeOnMainThread(new Runnable() {&#10;                                                @Override&#10;                                                public void run() {&#10;                                                    Toast.makeText(ProfileFormActivity.this,&#10;                                                        &quot;¡Perfil creado exitosamente!&quot;, Toast.LENGTH_SHORT).show();&#10;&#10;                                                    // Pequeño delay para mostrar el mensaje&#10;                                                    threadManager.executeWithDelay(new Runnable() {&#10;                                                        @Override&#10;                                                        public void run() {&#10;                                                            Log.d(TAG, &quot;Navegando a HomeActivity...&quot;);&#10;                                                            Intent intent = new Intent(ProfileFormActivity.this, HomeActivity.class);&#10;                                                            startActivity(intent);&#10;                                                            finish();&#10;                                                        }&#10;                                                    }, 500);&#10;                                                }&#10;                                            });&#10;                                        }&#10;                                    });&#10;                                } else {&#10;                                    // Manejar error del servidor&#10;                                    Log.e(TAG, &quot;Error al crear perfil - Status: &quot; + response.code());&#10;                                    String errorMsg = &quot;Error al crear perfil&quot;;&#10;&#10;                                    try {&#10;                                        if (response.errorBody() != null) {&#10;                                            String errorBody = response.errorBody().string();&#10;                                            Log.e(TAG, &quot;Error body: &quot; + errorBody);&#10;                                            // Intentar extraer el mensaje de error del JSON&#10;                                            if (errorBody.contains(&quot;message&quot;)) {&#10;                                                int start = errorBody.indexOf(&quot;\&quot;message\&quot;:\&quot;&quot;) + 11;&#10;                                                int end = errorBody.indexOf(&quot;\&quot;&quot;, start);&#10;                                                if (start &gt; 10 &amp;&amp; end &gt; start) {&#10;                                                    errorMsg = errorBody.substring(start, end);&#10;                                                }&#10;                                            }&#10;                                        }&#10;                                    } catch (Exception e) {&#10;                                        Log.e(TAG, &quot;Error al parsear error body: &quot; + e.getMessage());&#10;                                    }&#10;&#10;                                    Toast.makeText(ProfileFormActivity.this,&#10;                                        errorMsg, Toast.LENGTH_LONG).show();&#10;                                }&#10;                            }&#10;                        });&#10;                    }&#10;&#10;                    @Override&#10;                    public void onFailure(Call&lt;ProfileResponse&gt; call, Throwable t) {&#10;                        threadManager.executeOnMainThread(new Runnable() {&#10;                            @Override&#10;                            public void run() {&#10;                                loadingDialog.dismiss();&#10;                                buttonComplete.setEnabled(true);&#10;&#10;                                String errorMsg = t.getMessage();&#10;                                if (errorMsg == null || errorMsg.isEmpty()) {&#10;                                    errorMsg = &quot;Error desconocido&quot;;&#10;                                }&#10;                                Toast.makeText(ProfileFormActivity.this,&#10;                                    &quot;Error de conexión: &quot; + errorMsg, Toast.LENGTH_LONG).show();&#10;                            }&#10;                        });&#10;                    }&#10;                });&#10;            }&#10;        });&#10;    }&#10;&#10;    private void loadCurrentProfile() {&#10;        Log.d(TAG, &quot;loadCurrentProfile: Cargando perfil del usuario autenticado&quot;);&#10;        loadingDialog.show(&quot;Cargando perfil...&quot;);&#10;&#10;        authRepository.getProfile(token, new Callback&lt;GetProfileResponse&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;GetProfileResponse&gt; call, Response&lt;GetProfileResponse&gt; response) {&#10;                loadingDialog.dismiss();&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    GetProfileResponse profileResponse = response.body();&#10;                    if (profileResponse.getProfile() != null) {&#10;                        currentProfile = profileResponse.getProfile();&#10;                        profileId = currentProfile.getId(); // Guardar el ID del perfil para la actualización&#10;                        profileType = profileResponse.getProfileType(); // Actualizar el profileType del nivel superior&#10;                        populateFormWithProfileData();&#10;                    } else {&#10;                        Toast.makeText(ProfileFormActivity.this,&#10;                            &quot;Error: Perfil no encontrado&quot;,&#10;                            Toast.LENGTH_SHORT).show();&#10;                        finish();&#10;                    }&#10;                } else {&#10;                    Log.e(TAG, &quot;Error al cargar perfil: &quot; + response.code());&#10;                    Toast.makeText(ProfileFormActivity.this,&#10;                        &quot;Error al cargar el perfil&quot;,&#10;                        Toast.LENGTH_SHORT).show();&#10;                    finish();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;GetProfileResponse&gt; call, Throwable t) {&#10;                loadingDialog.dismiss();&#10;                Log.e(TAG, &quot;Error de conexión: &quot; + t.getMessage());&#10;                Toast.makeText(ProfileFormActivity.this,&#10;                    &quot;Error de conexión&quot;,&#10;                    Toast.LENGTH_SHORT).show();&#10;                finish();&#10;            }&#10;        });&#10;    }&#10;&#10;    private void populateFormWithProfileData() {&#10;        if (currentProfile == null) return;&#10;&#10;        Log.d(TAG, &quot;populateFormWithProfileData: Llenando formulario con datos&quot;);&#10;&#10;        // Llenar campos comunes&#10;        editTextName.setText(currentProfile.getName());&#10;        editTextDescription.setText(currentProfile.getDescription());&#10;        editTextPhone.setText(currentProfile.getPhoneNumber());&#10;        editTextInstagram.setText(currentProfile.getIgUser());&#10;        editTextTwitter.setText(currentProfile.getxUser());&#10;&#10;        // Seleccionar ubicación en el spinner&#10;        if (currentProfile.getLocationId() != null &amp;&amp; !locationList.isEmpty()) {&#10;            for (int i = 0; i &lt; locationList.size(); i++) {&#10;                if (locationList.get(i).getId() == currentProfile.getLocationId()) {&#10;                    spinnerLocation.setSelection(i);&#10;                    selectedLocationId = currentProfile.getLocationId();&#10;                    break;&#10;                }&#10;            }&#10;        }&#10;&#10;        // Seleccionar deporte en el spinner&#10;        if (currentProfile.getSportId() != null &amp;&amp; !sportList.isEmpty()) {&#10;            for (int i = 0; i &lt; sportList.size(); i++) {&#10;                if (sportList.get(i).getId() == currentProfile.getSportId()) {&#10;                    spinnerSport.setSelection(i);&#10;                    selectedSportId = currentProfile.getSportId();&#10;                    break;&#10;                }&#10;            }&#10;        }&#10;&#10;        // Llenar campos específicos por tipo de perfil&#10;        if (&quot;athlete&quot;.equalsIgnoreCase(profileType)) {&#10;            editTextLastName.setText(currentProfile.getLastName());&#10;            editTextHeight.setText(currentProfile.getHeight());&#10;            editTextWeight.setText(currentProfile.getWeight());&#10;&#10;            // Convertir fecha de ISO (YYYY-MM-DD) a formato display (DD/MM/YYYY)&#10;            if (currentProfile.getBirthdate() != null &amp;&amp; !currentProfile.getBirthdate().isEmpty()) {&#10;                selectedBirthdate = currentProfile.getBirthdate();&#10;                String displayDate = formatDateForDisplay(currentProfile.getBirthdate());&#10;                editTextBirthdate.setText(displayDate);&#10;&#10;                // Actualizar el calendario&#10;                try {&#10;                    String[] parts = currentProfile.getBirthdate().split(&quot;-&quot;);&#10;                    if (parts.length == 3) {&#10;                        birthdateCalendar.set(Calendar.YEAR, Integer.parseInt(parts[0]));&#10;                        birthdateCalendar.set(Calendar.MONTH, Integer.parseInt(parts[1]) - 1);&#10;                        birthdateCalendar.set(Calendar.DAY_OF_MONTH, Integer.parseInt(parts[2]));&#10;                    }&#10;                } catch (Exception e) {&#10;                    Log.e(TAG, &quot;Error al parsear fecha: &quot; + e.getMessage());&#10;                }&#10;            }&#10;        } else if (&quot;agent&quot;.equalsIgnoreCase(profileType)) {&#10;            editTextLastName.setText(currentProfile.getLastName());&#10;            editTextAgency.setText(currentProfile.getAgency());&#10;        } else if (&quot;team&quot;.equalsIgnoreCase(profileType)) {&#10;            editTextLastName.setText(currentProfile.getJob());&#10;        }&#10;    }&#10;&#10;    private String formatDateForDisplay(String isoDate) {&#10;        // Convertir de YYYY-MM-DD a DD/MM/YYYY&#10;        if (isoDate != null &amp;&amp; isoDate.length() == 10) {&#10;            String[] parts = isoDate.split(&quot;-&quot;);&#10;            if (parts.length == 3) {&#10;                return parts[2] + &quot;/&quot; + parts[1] + &quot;/&quot; + parts[0];&#10;            }&#10;        }&#10;        return isoDate;&#10;    }&#10;&#10;    private void updateProfile() {&#10;        Log.d(TAG, &quot;updateProfile: Actualizando perfil&quot;);&#10;&#10;        loadingDialog.show(&quot;Actualizando perfil...&quot;);&#10;        buttonComplete.setEnabled(false);&#10;&#10;        threadManager.executeInBackground(new Runnable() {&#10;            @Override&#10;            public void run() {&#10;                // Crear el objeto UpdateProfileRequest con la estructura correcta&#10;                final UpdateProfileRequest updateRequest = new UpdateProfileRequest();&#10;&#10;                // Crear el objeto profileUpdates&#10;                UpdateProfileRequest.ProfileUpdates profileUpdates = new UpdateProfileRequest.ProfileUpdates();&#10;                profileUpdates.setName(editTextName.getText().toString().trim());&#10;                profileUpdates.setDescription(editTextDescription.getText().toString().trim());&#10;                profileUpdates.setPhoneNumber(editTextPhone.getText().toString().trim());&#10;                profileUpdates.setIgUser(editTextInstagram.getText().toString().trim());&#10;                profileUpdates.setxUser(editTextTwitter.getText().toString().trim());&#10;                profileUpdates.setLocationId(selectedLocationId);&#10;                profileUpdates.setSportId(selectedSportId);&#10;&#10;                // Campos específicos según el tipo de perfil&#10;                if (profileType.equalsIgnoreCase(&quot;athlete&quot;)) {&#10;                    profileUpdates.setLastName(editTextLastName.getText().toString().trim());&#10;                    profileUpdates.setBirthdate(selectedBirthdate);&#10;                    profileUpdates.setHeight(editTextHeight.getText().toString().trim());&#10;                    profileUpdates.setWeight(editTextWeight.getText().toString().trim());&#10;                } else if (profileType.equalsIgnoreCase(&quot;agent&quot;)) {&#10;                    profileUpdates.setLastName(editTextLastName.getText().toString().trim());&#10;                    profileUpdates.setAgency(editTextAgency.getText().toString().trim());&#10;                } else if (profileType.equalsIgnoreCase(&quot;team&quot;)) {&#10;                    profileUpdates.setJob(editTextLastName.getText().toString().trim());&#10;                }&#10;&#10;                // Establecer profileUpdates en el request&#10;                updateRequest.setProfileUpdates(profileUpdates);&#10;&#10;                Log.d(TAG, &quot;updateProfile: Enviando actualización al backend&quot;);&#10;&#10;                // Enviar al backend&#10;                authRepository.updateProfile(token, updateRequest, new Callback&lt;ProfileResponse&gt;() {&#10;                    @Override&#10;                    public void onResponse(Call&lt;ProfileResponse&gt; call, Response&lt;ProfileResponse&gt; response) {&#10;                        threadManager.executeOnMainThread(new Runnable() {&#10;                            @Override&#10;                            public void run() {&#10;                                loadingDialog.dismiss();&#10;                                buttonComplete.setEnabled(true);&#10;&#10;                                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                                    Log.d(TAG, &quot;Perfil actualizado exitosamente&quot;);&#10;                                    Toast.makeText(ProfileFormActivity.this,&#10;                                        &quot;Perfil actualizado exitosamente&quot;, Toast.LENGTH_SHORT).show();&#10;&#10;                                    // Volver a la pantalla anterior&#10;                                    finish();&#10;                                } else {&#10;                                    Log.e(TAG, &quot;Error al actualizar perfil - Status: &quot; + response.code());&#10;                                    String errorMsg = &quot;Error al actualizar perfil&quot;;&#10;&#10;                                    try {&#10;                                        if (response.errorBody() != null) {&#10;                                            String errorBody = response.errorBody().string();&#10;                                            Log.e(TAG, &quot;Error body: &quot; + errorBody);&#10;                                            if (errorBody.contains(&quot;message&quot;)) {&#10;                                                int start = errorBody.indexOf(&quot;\&quot;message\&quot;:\&quot;&quot;) + 11;&#10;                                                int end = errorBody.indexOf(&quot;\&quot;&quot;, start);&#10;                                                if (start &gt; 10 &amp;&amp; end &gt; start) {&#10;                                                    errorMsg = errorBody.substring(start, end);&#10;                                                }&#10;                                            }&#10;                                        }&#10;                                    } catch (Exception e) {&#10;                                        Log.e(TAG, &quot;Error al parsear error body: &quot; + e.getMessage());&#10;                                    }&#10;&#10;                                    Toast.makeText(ProfileFormActivity.this,&#10;                                        errorMsg, Toast.LENGTH_LONG).show();&#10;                                }&#10;                            }&#10;                        });&#10;                    }&#10;&#10;                    @Override&#10;                    public void onFailure(Call&lt;ProfileResponse&gt; call, Throwable t) {&#10;                        threadManager.executeOnMainThread(new Runnable() {&#10;                            @Override&#10;                            public void run() {&#10;                                loadingDialog.dismiss();&#10;                                buttonComplete.setEnabled(true);&#10;&#10;                                String errorMsg = t.getMessage();&#10;                                if (errorMsg == null || errorMsg.isEmpty()) {&#10;                                    errorMsg = &quot;Error desconocido&quot;;&#10;                                }&#10;                                Toast.makeText(ProfileFormActivity.this,&#10;                                    &quot;Error de conexión: &quot; + errorMsg, Toast.LENGTH_LONG).show();&#10;                            }&#10;                        });&#10;                    }&#10;                });&#10;            }&#10;        });&#10;    }&#10;&#10;    @Override&#10;    protected void onDestroy() {&#10;        super.onDestroy();&#10;        // Cerrar el diálogo si está abierto&#10;        if (loadingDialog != null &amp;&amp; loadingDialog.isShowing()) {&#10;            loadingDialog.dismiss();&#10;        }&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.sportconnection;&#13;&#10;&#13;&#10;import android.app.DatePickerDialog;&#13;&#10;import android.content.Intent;&#13;&#10;import android.os.Bundle;&#13;&#10;import android.util.Log;&#13;&#10;import android.view.View;&#13;&#10;import android.widget.AdapterView;&#13;&#10;import android.widget.ArrayAdapter;&#13;&#10;import android.widget.Button;&#13;&#10;import android.widget.DatePicker;&#13;&#10;import android.widget.EditText;&#13;&#10;import android.widget.Spinner;&#13;&#10;import android.widget.TextView;&#13;&#10;import android.widget.Toast;&#13;&#10;&#13;&#10;import androidx.activity.EdgeToEdge;&#13;&#10;import androidx.appcompat.app.AppCompatActivity;&#13;&#10;&#13;&#10;import java.text.SimpleDateFormat;&#13;&#10;import java.util.Calendar;&#13;&#10;import java.util.Locale;&#13;&#10;&#13;&#10;import com.example.sportconnection.model.Location;&#13;&#10;import com.example.sportconnection.model.ProfileRequest;&#13;&#10;import com.example.sportconnection.model.ProfileResponse;&#13;&#10;import com.example.sportconnection.model.GetProfileResponse;&#13;&#10;import com.example.sportconnection.model.UpdateProfileRequest;&#13;&#10;import com.example.sportconnection.model.Sport;&#13;&#10;import com.example.sportconnection.repository.AuthRepository;&#13;&#10;import com.example.sportconnection.repository.LookupRepository;&#13;&#10;import com.example.sportconnection.utils.LoadingDialog;&#13;&#10;import com.example.sportconnection.utils.SessionManager;&#13;&#10;import com.example.sportconnection.utils.ThreadManager;&#13;&#10;&#13;&#10;import java.util.ArrayList;&#13;&#10;import java.util.List;&#13;&#10;&#13;&#10;import retrofit2.Call;&#13;&#10;import retrofit2.Callback;&#13;&#10;import retrofit2.Response;&#13;&#10;&#13;&#10;public class ProfileFormActivity extends AppCompatActivity {&#13;&#10;&#13;&#10;    private static final String TAG = &quot;ProfileFormActivity&quot;;&#13;&#10;&#13;&#10;    private TextView titleProfileForm;&#13;&#10;    private EditText editTextName, editTextLastName, editTextBirthdate;&#13;&#10;    private EditText editTextHeight, editTextWeight;&#13;&#10;    private Spinner spinnerLocation, spinnerSport;&#13;&#10;    private EditText editTextPhone, editTextInstagram;&#13;&#10;    private EditText editTextTwitter, editTextDescription, editTextAgency;&#13;&#10;    private Button buttonComplete;&#13;&#10;&#13;&#10;    private String email, password, profileType, token;&#13;&#10;    private int userId;&#13;&#10;&#13;&#10;    // Variables para modo edición&#13;&#10;    private boolean isEditMode = false;&#13;&#10;    private int profileId = -1;&#13;&#10;    private GetProfileResponse.ProfileData currentProfile;&#13;&#10;&#13;&#10;    private AuthRepository authRepository;&#13;&#10;    private LookupRepository lookupRepository;&#13;&#10;    private SessionManager sessionManager;&#13;&#10;    private LoadingDialog loadingDialog;&#13;&#10;    private ThreadManager threadManager;&#13;&#10;&#13;&#10;    private List&lt;Sport&gt; sportList = new ArrayList&lt;&gt;();&#13;&#10;    private List&lt;Location&gt; locationList = new ArrayList&lt;&gt;();&#13;&#10;    private int selectedSportId = -1;&#13;&#10;    private int selectedLocationId = -1;&#13;&#10;&#13;&#10;    private String selectedBirthdate = &quot;&quot;; // Formato ISO: YYYY-MM-DD&#13;&#10;    private Calendar birthdateCalendar = Calendar.getInstance();&#13;&#10;&#13;&#10;    @Override&#13;&#10;    protected void onCreate(Bundle savedInstanceState) {&#13;&#10;        super.onCreate(savedInstanceState);&#13;&#10;        EdgeToEdge.enable(this);&#13;&#10;        setContentView(R.layout.activity_profile_form);&#13;&#10;&#13;&#10;        // Obtener datos del Intent&#10;        isEditMode = getIntent().getBooleanExtra(&quot;isEditMode&quot;, false);&#10;&#10;        if (isEditMode) {&#10;            // Modo edición - obtener desde sesión o intent&#10;            sessionManager = new SessionManager(this);&#10;            token = sessionManager.getToken();&#10;            userId = sessionManager.getUserId();&#10;            email = sessionManager.getEmail();&#10;            &#10;            // Intentar obtener profileType del intent primero (más confiable), si no, de la sesión&#10;            profileType = getIntent().getStringExtra(&quot;profileType&quot;);&#10;            if (profileType == null) {&#10;                profileType = sessionManager.getProfileType();&#10;                Log.d(TAG, &quot;onCreate: ProfileType obtenido de sesión: &quot; + profileType);&#10;            } else {&#10;                Log.d(TAG, &quot;onCreate: ProfileType obtenido de intent: &quot; + profileType);&#10;            }&#10;&#10;            Log.d(TAG, &quot;onCreate: Modo EDICIÓN - profileType=&quot; + profileType);&#10;        } else {&#10;            // Modo creación - obtener desde intent&#10;            email = getIntent().getStringExtra(&quot;email&quot;);&#10;            password = getIntent().getStringExtra(&quot;password&quot;);&#10;            profileType = getIntent().getStringExtra(&quot;profileType&quot;);&#10;            token = getIntent().getStringExtra(&quot;token&quot;);&#10;            userId = getIntent().getIntExtra(&quot;userId&quot;, -1);&#10;&#10;            Log.d(TAG, &quot;onCreate: Modo CREACIÓN - profileType=&quot; + profileType + &quot;, userId=&quot; + userId);&#10;        }&#13;&#10;&#13;&#10;        // Inicializar vistas&#13;&#10;        titleProfileForm = findViewById(R.id.titleProfileForm);&#13;&#10;        editTextName = findViewById(R.id.editTextName);&#13;&#10;        editTextLastName = findViewById(R.id.editTextLastName);&#13;&#10;        editTextBirthdate = findViewById(R.id.editTextBirthdate);&#13;&#10;        editTextHeight = findViewById(R.id.editTextHeight);&#13;&#10;        editTextWeight = findViewById(R.id.editTextWeight);&#13;&#10;        spinnerLocation = findViewById(R.id.spinnerLocation);&#13;&#10;        spinnerSport = findViewById(R.id.spinnerSport);&#13;&#10;        editTextPhone = findViewById(R.id.editTextPhone);&#13;&#10;        editTextInstagram = findViewById(R.id.editTextInstagram);&#13;&#10;        editTextTwitter = findViewById(R.id.editTextTwitter);&#13;&#10;        editTextDescription = findViewById(R.id.editTextDescription);&#13;&#10;        editTextAgency = findViewById(R.id.editTextAgency);&#13;&#10;        buttonComplete = findViewById(R.id.buttonComplete);&#13;&#10;&#13;&#10;        // Inicializar repositorios y utilidades&#13;&#10;        authRepository = new AuthRepository();&#13;&#10;        lookupRepository = new LookupRepository();&#13;&#10;        if (sessionManager == null) {&#13;&#10;            sessionManager = new SessionManager(this);&#13;&#10;        }&#13;&#10;        loadingDialog = new LoadingDialog(this);&#13;&#10;        threadManager = ThreadManager.getInstance();&#13;&#10;&#13;&#10;        // Configurar el formulario según el tipo de perfil&#13;&#10;        setupFormByProfileType();&#13;&#10;&#13;&#10;        // Cargar datos de sports y locations&#13;&#10;        loadSportsAndLocations();&#13;&#10;&#13;&#10;        // Configurar el selector de fecha de nacimiento&#13;&#10;        setupBirthdatePicker();&#13;&#10;&#13;&#10;        // Si es modo edición, cargar los datos actuales del perfil&#13;&#10;        if (isEditMode) {&#13;&#10;            buttonComplete.setText(&quot;Guardar Cambios&quot;);&#13;&#10;            loadCurrentProfile();&#13;&#10;        }&#13;&#10;&#13;&#10;        // Configurar el botón de completar/guardar&#13;&#10;        buttonComplete.setOnClickListener(new View.OnClickListener() {&#13;&#10;            @Override&#13;&#10;            public void onClick(View v) {&#13;&#10;                if (validateForm()) {&#13;&#10;                    if (isEditMode) {&#13;&#10;                        updateProfile();&#13;&#10;                    } else {&#13;&#10;                        completeRegistration();&#13;&#10;                    }&#13;&#10;                }&#13;&#10;            }&#13;&#10;        });&#13;&#10;    }&#13;&#10;&#13;&#10;    private void setupFormByProfileType() {&#13;&#10;        Log.d(TAG, &quot;setupFormByProfileType: &quot; + profileType);&#13;&#10;&#13;&#10;        switch (profileType.toLowerCase()) {&#13;&#10;            case &quot;athlete&quot;:&#13;&#10;                titleProfileForm.setText(&quot;Perfil de Atleta&quot;);&#13;&#10;                editTextName.setHint(&quot;Nombre&quot;);&#13;&#10;                editTextLastName.setVisibility(View.VISIBLE);&#13;&#10;                editTextLastName.setHint(&quot;Apellido&quot;);&#13;&#10;                editTextBirthdate.setVisibility(View.VISIBLE);&#13;&#10;                editTextHeight.setVisibility(View.VISIBLE);&#13;&#10;                editTextWeight.setVisibility(View.VISIBLE);&#13;&#10;                editTextAgency.setVisibility(View.GONE);&#13;&#10;                break;&#13;&#10;&#13;&#10;            case &quot;agent&quot;:&#13;&#10;                titleProfileForm.setText(&quot;Perfil de Agente&quot;);&#13;&#10;                editTextName.setHint(&quot;Nombre&quot;);&#13;&#10;                editTextLastName.setVisibility(View.VISIBLE);&#13;&#10;                editTextLastName.setHint(&quot;Apellido&quot;);&#13;&#10;                editTextBirthdate.setVisibility(View.GONE);&#13;&#10;                editTextHeight.setVisibility(View.GONE);&#13;&#10;                editTextWeight.setVisibility(View.GONE);&#13;&#10;                editTextDescription.setHint(&quot;Descripción&quot;);&#13;&#10;                editTextAgency.setVisibility(View.VISIBLE);&#13;&#10;                break;&#13;&#10;&#13;&#10;            case &quot;team&quot;:&#13;&#10;                titleProfileForm.setText(&quot;Perfil de Equipo&quot;);&#13;&#10;                editTextName.setHint(&quot;Nombre del equipo&quot;);&#13;&#10;                editTextLastName.setVisibility(View.VISIBLE);&#13;&#10;                editTextLastName.setHint(&quot;Puesto/Rol&quot;);&#13;&#10;                editTextBirthdate.setVisibility(View.GONE);&#13;&#10;                editTextHeight.setVisibility(View.GONE);&#13;&#10;                editTextWeight.setVisibility(View.GONE);&#13;&#10;                editTextAgency.setVisibility(View.GONE);&#13;&#10;                break;&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    private void setupBirthdatePicker() {&#13;&#10;        // Configurar fecha máxima (hoy)&#13;&#10;        final Calendar maxDate = Calendar.getInstance();&#13;&#10;&#13;&#10;        // Configurar fecha mínima (40 años atrás)&#13;&#10;        final Calendar minDate = Calendar.getInstance();&#13;&#10;        minDate.add(Calendar.YEAR, -40);&#13;&#10;&#13;&#10;        // Configurar fecha inicial (18 años atrás, edad mínima típica)&#13;&#10;        birthdateCalendar.add(Calendar.YEAR, -18);&#13;&#10;&#13;&#10;        editTextBirthdate.setOnClickListener(new View.OnClickListener() {&#13;&#10;            @Override&#13;&#10;            public void onClick(View v) {&#13;&#10;                int year = birthdateCalendar.get(Calendar.YEAR);&#13;&#10;                int month = birthdateCalendar.get(Calendar.MONTH);&#13;&#10;                int day = birthdateCalendar.get(Calendar.DAY_OF_MONTH);&#13;&#10;&#13;&#10;                DatePickerDialog datePickerDialog = new DatePickerDialog(&#13;&#10;                    ProfileFormActivity.this,&#13;&#10;                    new DatePickerDialog.OnDateSetListener() {&#13;&#10;                        @Override&#13;&#10;                        public void onDateSet(DatePicker view, int year, int month, int dayOfMonth) {&#13;&#10;                            // Actualizar el calendario con la fecha seleccionada&#13;&#10;                            birthdateCalendar.set(Calendar.YEAR, year);&#13;&#10;                            birthdateCalendar.set(Calendar.MONTH, month);&#13;&#10;                            birthdateCalendar.set(Calendar.DAY_OF_MONTH, dayOfMonth);&#13;&#10;&#13;&#10;                            // Formato para mostrar al usuario (DD/MM/YYYY)&#13;&#10;                            SimpleDateFormat displayFormat = new SimpleDateFormat(&quot;dd/MM/yyyy&quot;, Locale.getDefault());&#13;&#10;                            String displayDate = displayFormat.format(birthdateCalendar.getTime());&#13;&#10;                            editTextBirthdate.setText(displayDate);&#13;&#10;&#13;&#10;                            // Formato ISO para enviar al backend (YYYY-MM-DD)&#13;&#10;                            SimpleDateFormat isoFormat = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;, Locale.getDefault());&#13;&#10;                            selectedBirthdate = isoFormat.format(birthdateCalendar.getTime());&#13;&#10;&#13;&#10;                            Log.d(TAG, &quot;Fecha seleccionada - Display: &quot; + displayDate + &quot;, ISO: &quot; + selectedBirthdate);&#13;&#10;                        }&#13;&#10;                    },&#13;&#10;                    year, month, day&#13;&#10;                );&#13;&#10;&#13;&#10;                // Configurar fechas límite&#13;&#10;                datePickerDialog.getDatePicker().setMaxDate(maxDate.getTimeInMillis());&#13;&#10;                datePickerDialog.getDatePicker().setMinDate(minDate.getTimeInMillis());&#13;&#10;&#13;&#10;                datePickerDialog.show();&#13;&#10;            }&#13;&#10;        });&#13;&#10;    }&#13;&#10;&#13;&#10;    private void loadSportsAndLocations() {&#13;&#10;        Log.d(TAG, &quot;loadSportsAndLocations: Iniciando carga de datos&quot;);&#13;&#10;        loadingDialog.show(&quot;Cargando datos...&quot;);&#13;&#10;&#13;&#10;        // Cargar deportes&#13;&#10;        lookupRepository.getSports(new Callback&lt;List&lt;Sport&gt;&gt;() {&#13;&#10;            @Override&#13;&#10;            public void onResponse(Call&lt;List&lt;Sport&gt;&gt; call, Response&lt;List&lt;Sport&gt;&gt; response) {&#13;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#13;&#10;                    sportList = response.body();&#13;&#10;                    Log.d(TAG, &quot;Sports cargados: &quot; + sportList.size());&#13;&#10;                    setupSportSpinner();&#13;&#10;                    checkIfDataLoaded();&#13;&#10;                } else {&#13;&#10;                    Log.e(TAG, &quot;Error al cargar sports: &quot; + response.code());&#13;&#10;                    runOnUiThread(new Runnable() {&#13;&#10;                        @Override&#13;&#10;                        public void run() {&#13;&#10;                            loadingDialog.dismiss();&#13;&#10;                            Toast.makeText(ProfileFormActivity.this,&#13;&#10;                                &quot;Error al cargar deportes&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;                        }&#13;&#10;                    });&#13;&#10;                }&#13;&#10;            }&#13;&#10;&#13;&#10;            @Override&#13;&#10;            public void onFailure(Call&lt;List&lt;Sport&gt;&gt; call, Throwable t) {&#13;&#10;                Log.e(TAG, &quot;Failure al cargar sports: &quot; + t.getMessage());&#13;&#10;                runOnUiThread(new Runnable() {&#13;&#10;                    @Override&#13;&#10;                    public void run() {&#13;&#10;                        loadingDialog.dismiss();&#13;&#10;                        Toast.makeText(ProfileFormActivity.this,&#13;&#10;                            &quot;Error de conexión al cargar deportes&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;                    }&#13;&#10;                });&#13;&#10;            }&#13;&#10;        });&#13;&#10;&#13;&#10;        // Cargar ubicaciones&#13;&#10;        lookupRepository.getLocations(new Callback&lt;List&lt;Location&gt;&gt;() {&#13;&#10;            @Override&#13;&#10;            public void onResponse(Call&lt;List&lt;Location&gt;&gt; call, Response&lt;List&lt;Location&gt;&gt; response) {&#13;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#13;&#10;                    locationList = response.body();&#13;&#10;                    Log.d(TAG, &quot;Locations cargadas: &quot; + locationList.size());&#13;&#10;                    setupLocationSpinner();&#13;&#10;                    checkIfDataLoaded();&#13;&#10;                } else {&#13;&#10;                    Log.e(TAG, &quot;Error al cargar locations: &quot; + response.code());&#13;&#10;                    runOnUiThread(new Runnable() {&#13;&#10;                        @Override&#13;&#10;                        public void run() {&#13;&#10;                            loadingDialog.dismiss();&#13;&#10;                            Toast.makeText(ProfileFormActivity.this,&#13;&#10;                                &quot;Error al cargar ubicaciones&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;                        }&#13;&#10;                    });&#13;&#10;                }&#13;&#10;            }&#13;&#10;&#13;&#10;            @Override&#13;&#10;            public void onFailure(Call&lt;List&lt;Location&gt;&gt; call, Throwable t) {&#13;&#10;                Log.e(TAG, &quot;Failure al cargar locations: &quot; + t.getMessage());&#13;&#10;                runOnUiThread(new Runnable() {&#13;&#10;                    @Override&#13;&#10;                    public void run() {&#13;&#10;                        loadingDialog.dismiss();&#13;&#10;                        Toast.makeText(ProfileFormActivity.this,&#13;&#10;                            &quot;Error de conexión al cargar ubicaciones&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;                    }&#13;&#10;                });&#13;&#10;            }&#13;&#10;        });&#13;&#10;    }&#13;&#10;&#13;&#10;    private void setupSportSpinner() {&#13;&#10;        ArrayAdapter&lt;Sport&gt; adapter = new ArrayAdapter&lt;&gt;(this,&#13;&#10;            android.R.layout.simple_spinner_item, sportList);&#13;&#10;        adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);&#13;&#10;&#13;&#10;        runOnUiThread(new Runnable() {&#13;&#10;            @Override&#13;&#10;            public void run() {&#13;&#10;                spinnerSport.setAdapter(adapter);&#13;&#10;                spinnerSport.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {&#13;&#10;                    @Override&#13;&#10;                    public void onItemSelected(AdapterView&lt;?&gt; parent, View view, int position, long id) {&#13;&#10;                        selectedSportId = sportList.get(position).getId();&#13;&#10;                        Log.d(TAG, &quot;Sport seleccionado: &quot; + sportList.get(position).getName() +&#13;&#10;                            &quot; (ID: &quot; + selectedSportId + &quot;)&quot;);&#13;&#10;                    }&#13;&#10;&#13;&#10;                    @Override&#13;&#10;                    public void onNothingSelected(AdapterView&lt;?&gt; parent) {&#13;&#10;                        selectedSportId = -1;&#13;&#10;                    }&#13;&#10;                });&#13;&#10;            }&#13;&#10;        });&#13;&#10;    }&#13;&#10;&#13;&#10;    private void setupLocationSpinner() {&#13;&#10;        ArrayAdapter&lt;Location&gt; adapter = new ArrayAdapter&lt;&gt;(this,&#13;&#10;            android.R.layout.simple_spinner_item, locationList);&#13;&#10;        adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);&#13;&#10;&#13;&#10;        runOnUiThread(new Runnable() {&#13;&#10;            @Override&#13;&#10;            public void run() {&#13;&#10;                spinnerLocation.setAdapter(adapter);&#13;&#10;                spinnerLocation.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {&#13;&#10;                    @Override&#13;&#10;                    public void onItemSelected(AdapterView&lt;?&gt; parent, View view, int position, long id) {&#13;&#10;                        selectedLocationId = locationList.get(position).getId();&#13;&#10;                        Log.d(TAG, &quot;Location seleccionada: &quot; + locationList.get(position).toString() +&#13;&#10;                            &quot; (ID: &quot; + selectedLocationId + &quot;)&quot;);&#13;&#10;                    }&#13;&#10;&#13;&#10;                    @Override&#13;&#10;                    public void onNothingSelected(AdapterView&lt;?&gt; parent) {&#13;&#10;                        selectedLocationId = -1;&#13;&#10;                    }&#13;&#10;                });&#13;&#10;            }&#13;&#10;        });&#13;&#10;    }&#13;&#10;&#13;&#10;    private void checkIfDataLoaded() {&#13;&#10;        if (!sportList.isEmpty() &amp;&amp; !locationList.isEmpty()) {&#13;&#10;            runOnUiThread(new Runnable() {&#13;&#10;                @Override&#13;&#10;                public void run() {&#13;&#10;                    loadingDialog.dismiss();&#13;&#10;                    Log.d(TAG, &quot;Datos cargados completamente&quot;);&#13;&#10;&#13;&#10;                    // Si estamos en modo edición y ya tenemos el perfil, llenar el formulario&#13;&#10;                    if (isEditMode &amp;&amp; currentProfile != null) {&#13;&#10;                        populateFormWithProfileData();&#13;&#10;                    }&#13;&#10;                }&#13;&#10;            });&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    private boolean validateForm() {&#13;&#10;        String name = editTextName.getText().toString().trim();&#13;&#10;        String phone = editTextPhone.getText().toString().trim();&#13;&#10;&#13;&#10;        if (name.isEmpty()) {&#13;&#10;            Toast.makeText(this, &quot;Por favor, ingresa el nombre&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;            return false;&#13;&#10;        }&#13;&#10;&#13;&#10;        if (profileType.equalsIgnoreCase(&quot;athlete&quot;) || profileType.equalsIgnoreCase(&quot;agent&quot;)) {&#13;&#10;            String lastName = editTextLastName.getText().toString().trim();&#13;&#10;            if (lastName.isEmpty()) {&#13;&#10;                Toast.makeText(this, &quot;Por favor, ingresa el apellido&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;                return false;&#13;&#10;            }&#13;&#10;        }&#13;&#10;&#13;&#10;        if (profileType.equalsIgnoreCase(&quot;athlete&quot;)) {&#13;&#10;            String height = editTextHeight.getText().toString().trim();&#13;&#10;            String weight = editTextWeight.getText().toString().trim();&#13;&#10;&#13;&#10;            if (selectedBirthdate.isEmpty()) {&#13;&#10;                Toast.makeText(this, &quot;Por favor, selecciona tu fecha de nacimiento&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;                return false;&#13;&#10;            }&#13;&#10;&#13;&#10;            if (height.isEmpty() || weight.isEmpty()) {&#13;&#10;                Toast.makeText(this, &quot;Por favor, completa todos los campos obligatorios&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;                return false;&#13;&#10;            }&#13;&#10;        }&#13;&#10;&#13;&#10;        if (profileType.equalsIgnoreCase(&quot;agent&quot;)) {&#13;&#10;            String agency = editTextAgency.getText().toString().trim();&#13;&#10;        }&#13;&#10;&#13;&#10;        if (profileType.equalsIgnoreCase(&quot;team&quot;)) {&#13;&#10;            String job = editTextLastName.getText().toString().trim();&#13;&#10;            if (job.isEmpty()) {&#13;&#10;                Toast.makeText(this, &quot;Por favor, ingresa el puesto/rol&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;                return false;&#13;&#10;            }&#13;&#10;        }&#13;&#10;&#13;&#10;        if (selectedLocationId == -1 || selectedSportId == -1) {&#13;&#10;            Toast.makeText(this, &quot;Por favor, selecciona ubicación y deporte&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;            return false;&#13;&#10;        }&#13;&#10;&#13;&#10;        if (phone.isEmpty()) {&#13;&#10;            Toast.makeText(this, &quot;Por favor, ingresa el número de teléfono&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;            return false;&#13;&#10;        }&#13;&#10;&#13;&#10;        return true;&#13;&#10;    }&#13;&#10;&#13;&#10;    private void completeRegistration() {&#13;&#10;        Log.d(TAG, &quot;completeRegistration: Iniciando&quot;);&#13;&#10;&#13;&#10;        // Mostrar diálogo de carga&#13;&#10;        loadingDialog.show(&quot;Creando perfil...&quot;);&#13;&#10;        buttonComplete.setEnabled(false);&#13;&#10;&#13;&#10;        // Crear el objeto ProfileRequest en segundo plano&#13;&#10;        threadManager.executeInBackground(new Runnable() {&#13;&#10;            @Override&#13;&#10;            public void run() {&#13;&#10;                final ProfileRequest profileRequest = new ProfileRequest();&#13;&#10;                profileRequest.setProfileType(profileType.toLowerCase());&#13;&#10;                profileRequest.setName(editTextName.getText().toString().trim());&#13;&#10;                profileRequest.setDescription(editTextDescription.getText().toString().trim());&#13;&#10;                profileRequest.setPhoneNumber(editTextPhone.getText().toString().trim());&#13;&#10;                profileRequest.setIgUser(editTextInstagram.getText().toString().trim());&#13;&#10;                profileRequest.setxUser(editTextTwitter.getText().toString().trim());&#13;&#10;                profileRequest.setLocationId(selectedLocationId);&#13;&#10;                profileRequest.setSportId(selectedSportId);&#13;&#10;&#13;&#10;                Log.d(TAG, &quot;ProfileRequest: profileType=&quot; + profileType.toLowerCase() +&#13;&#10;                    &quot;, locationId=&quot; + selectedLocationId + &quot;, sportId=&quot; + selectedSportId);&#13;&#10;&#13;&#10;                // Campos específicos según el tipo de perfil&#13;&#10;                if (profileType.equalsIgnoreCase(&quot;athlete&quot;)) {&#13;&#10;                    profileRequest.setLastName(editTextLastName.getText().toString().trim());&#13;&#10;                    // Usar la fecha en formato ISO (YYYY-MM-DD)&#13;&#10;                    profileRequest.setBirthdate(selectedBirthdate);&#13;&#10;                    profileRequest.setHeight(editTextHeight.getText().toString().trim());&#13;&#10;                    profileRequest.setWeight(editTextWeight.getText().toString().trim());&#13;&#10;&#13;&#10;                    Log.d(TAG, &quot;Athlete profile - Birthdate ISO: &quot; + selectedBirthdate);&#13;&#10;                } else if (profileType.equalsIgnoreCase(&quot;agent&quot;)) {&#13;&#10;                    profileRequest.setLastName(editTextLastName.getText().toString().trim());&#13;&#10;                    profileRequest.setAgency(editTextAgency.getText().toString().trim());&#13;&#10;                } else if (profileType.equalsIgnoreCase(&quot;team&quot;)) {&#13;&#10;                    profileRequest.setJob(editTextLastName.getText().toString().trim());&#13;&#10;                }&#13;&#10;&#13;&#10;                // Enviar al backend&#13;&#10;                authRepository.createProfile(token, profileRequest, new Callback&lt;ProfileResponse&gt;() {&#13;&#10;                    @Override&#13;&#10;                    public void onResponse(Call&lt;ProfileResponse&gt; call, Response&lt;ProfileResponse&gt; response) {&#13;&#10;                        threadManager.executeOnMainThread(new Runnable() {&#13;&#10;                            @Override&#13;&#10;                            public void run() {&#13;&#10;                                loadingDialog.dismiss();&#13;&#10;                                buttonComplete.setEnabled(true);&#13;&#10;&#13;&#10;                                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#13;&#10;                                    // Si la respuesta HTTP es exitosa (200-299), el perfil se creó correctamente&#13;&#10;                                    Log.d(TAG, &quot;Perfil creado exitosamente - Status: &quot; + response.code());&#13;&#10;&#13;&#10;                                    // Guardar la sesión en segundo plano&#13;&#10;                                    threadManager.executeInBackground(new Runnable() {&#13;&#10;                                        @Override&#13;&#10;                                        public void run() {&#13;&#10;                                            sessionManager.saveSession(token, userId, email, profileType);&#13;&#10;&#13;&#10;                                            // Navegar en el hilo principal&#13;&#10;                                            threadManager.executeOnMainThread(new Runnable() {&#13;&#10;                                                @Override&#13;&#10;                                                public void run() {&#13;&#10;                                                    Toast.makeText(ProfileFormActivity.this,&#13;&#10;                                                        &quot;¡Perfil creado exitosamente!&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;&#13;&#10;                                                    // Pequeño delay para mostrar el mensaje&#13;&#10;                                                    threadManager.executeWithDelay(new Runnable() {&#13;&#10;                                                        @Override&#13;&#10;                                                        public void run() {&#13;&#10;                                                            Log.d(TAG, &quot;Navegando a HomeActivity...&quot;);&#13;&#10;                                                            Intent intent = new Intent(ProfileFormActivity.this, HomeActivity.class);&#13;&#10;                                                            startActivity(intent);&#13;&#10;                                                            finish();&#13;&#10;                                                        }&#13;&#10;                                                    }, 500);&#13;&#10;                                                }&#13;&#10;                                            });&#13;&#10;                                        }&#13;&#10;                                    });&#13;&#10;                                } else {&#13;&#10;                                    // Manejar error del servidor&#13;&#10;                                    Log.e(TAG, &quot;Error al crear perfil - Status: &quot; + response.code());&#13;&#10;                                    String errorMsg = &quot;Error al crear perfil&quot;;&#13;&#10;&#13;&#10;                                    try {&#13;&#10;                                        if (response.errorBody() != null) {&#13;&#10;                                            String errorBody = response.errorBody().string();&#13;&#10;                                            Log.e(TAG, &quot;Error body: &quot; + errorBody);&#13;&#10;                                            // Intentar extraer el mensaje de error del JSON&#13;&#10;                                            if (errorBody.contains(&quot;message&quot;)) {&#13;&#10;                                                int start = errorBody.indexOf(&quot;\&quot;message\&quot;:\&quot;&quot;) + 11;&#13;&#10;                                                int end = errorBody.indexOf(&quot;\&quot;&quot;, start);&#13;&#10;                                                if (start &gt; 10 &amp;&amp; end &gt; start) {&#13;&#10;                                                    errorMsg = errorBody.substring(start, end);&#13;&#10;                                                }&#13;&#10;                                            }&#13;&#10;                                        }&#13;&#10;                                    } catch (Exception e) {&#13;&#10;                                        Log.e(TAG, &quot;Error al parsear error body: &quot; + e.getMessage());&#13;&#10;                                    }&#13;&#10;&#13;&#10;                                    Toast.makeText(ProfileFormActivity.this,&#13;&#10;                                        errorMsg, Toast.LENGTH_LONG).show();&#13;&#10;                                }&#13;&#10;                            }&#13;&#10;                        });&#13;&#10;                    }&#13;&#10;&#13;&#10;                    @Override&#13;&#10;                    public void onFailure(Call&lt;ProfileResponse&gt; call, Throwable t) {&#13;&#10;                        threadManager.executeOnMainThread(new Runnable() {&#13;&#10;                            @Override&#13;&#10;                            public void run() {&#13;&#10;                                loadingDialog.dismiss();&#13;&#10;                                buttonComplete.setEnabled(true);&#13;&#10;&#13;&#10;                                String errorMsg = t.getMessage();&#13;&#10;                                if (errorMsg == null || errorMsg.isEmpty()) {&#13;&#10;                                    errorMsg = &quot;Error desconocido&quot;;&#13;&#10;                                }&#13;&#10;                                Toast.makeText(ProfileFormActivity.this,&#13;&#10;                                    &quot;Error de conexión: &quot; + errorMsg, Toast.LENGTH_LONG).show();&#13;&#10;                            }&#13;&#10;                        });&#13;&#10;                    }&#13;&#10;                });&#13;&#10;            }&#13;&#10;        });&#13;&#10;    }&#13;&#10;&#13;&#10;    private void loadCurrentProfile() {&#13;&#10;        Log.d(TAG, &quot;loadCurrentProfile: Cargando perfil del usuario autenticado&quot;);&#13;&#10;        loadingDialog.show(&quot;Cargando perfil...&quot;);&#13;&#10;&#13;&#10;        authRepository.getProfile(token, new Callback&lt;GetProfileResponse&gt;() {&#13;&#10;            @Override&#13;&#10;            public void onResponse(Call&lt;GetProfileResponse&gt; call, Response&lt;GetProfileResponse&gt; response) {&#13;&#10;                loadingDialog.dismiss();&#13;&#10;&#13;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#13;&#10;                    GetProfileResponse profileResponse = response.body();&#13;&#10;                    if (profileResponse.getProfile() != null) {&#13;&#10;                        currentProfile = profileResponse.getProfile();&#13;&#10;                        profileId = currentProfile.getId(); // Guardar el ID del perfil para la actualización&#13;&#10;                        profileType = profileResponse.getProfileType(); // Actualizar el profileType del nivel superior&#13;&#10;                        populateFormWithProfileData();&#13;&#10;                    } else {&#13;&#10;                        Toast.makeText(ProfileFormActivity.this,&#13;&#10;                            &quot;Error: Perfil no encontrado&quot;,&#13;&#10;                            Toast.LENGTH_SHORT).show();&#13;&#10;                        finish();&#13;&#10;                    }&#13;&#10;                } else {&#13;&#10;                    Log.e(TAG, &quot;Error al cargar perfil: &quot; + response.code());&#13;&#10;                    Toast.makeText(ProfileFormActivity.this,&#13;&#10;                        &quot;Error al cargar el perfil&quot;,&#13;&#10;                        Toast.LENGTH_SHORT).show();&#13;&#10;                    finish();&#13;&#10;                }&#13;&#10;            }&#13;&#10;&#13;&#10;            @Override&#13;&#10;            public void onFailure(Call&lt;GetProfileResponse&gt; call, Throwable t) {&#13;&#10;                loadingDialog.dismiss();&#13;&#10;                Log.e(TAG, &quot;Error de conexión: &quot; + t.getMessage());&#13;&#10;                Toast.makeText(ProfileFormActivity.this,&#13;&#10;                    &quot;Error de conexión&quot;,&#13;&#10;                    Toast.LENGTH_SHORT).show();&#13;&#10;                finish();&#13;&#10;            }&#13;&#10;        });&#13;&#10;    }&#13;&#10;&#13;&#10;    private void populateFormWithProfileData() {&#13;&#10;        if (currentProfile == null) return;&#13;&#10;&#13;&#10;        Log.d(TAG, &quot;populateFormWithProfileData: Llenando formulario con datos&quot;);&#13;&#10;&#13;&#10;        // Llenar campos comunes&#13;&#10;        editTextName.setText(currentProfile.getName());&#13;&#10;        editTextDescription.setText(currentProfile.getDescription());&#13;&#10;        editTextPhone.setText(currentProfile.getPhoneNumber());&#13;&#10;        editTextInstagram.setText(currentProfile.getIgUser());&#13;&#10;        editTextTwitter.setText(currentProfile.getxUser());&#13;&#10;&#13;&#10;        // Seleccionar ubicación en el spinner&#13;&#10;        if (currentProfile.getLocationId() != null &amp;&amp; !locationList.isEmpty()) {&#13;&#10;            for (int i = 0; i &lt; locationList.size(); i++) {&#13;&#10;                if (locationList.get(i).getId() == currentProfile.getLocationId()) {&#13;&#10;                    spinnerLocation.setSelection(i);&#13;&#10;                    selectedLocationId = currentProfile.getLocationId();&#13;&#10;                    break;&#13;&#10;                }&#13;&#10;            }&#13;&#10;        }&#13;&#10;&#13;&#10;        // Seleccionar deporte en el spinner&#13;&#10;        if (currentProfile.getSportId() != null &amp;&amp; !sportList.isEmpty()) {&#13;&#10;            for (int i = 0; i &lt; sportList.size(); i++) {&#13;&#10;                if (sportList.get(i).getId() == currentProfile.getSportId()) {&#13;&#10;                    spinnerSport.setSelection(i);&#13;&#10;                    selectedSportId = currentProfile.getSportId();&#13;&#10;                    break;&#13;&#10;                }&#13;&#10;            }&#13;&#10;        }&#13;&#10;&#13;&#10;        // Llenar campos específicos por tipo de perfil&#13;&#10;        if (&quot;athlete&quot;.equalsIgnoreCase(profileType)) {&#13;&#10;            editTextLastName.setText(currentProfile.getLastName());&#13;&#10;            editTextHeight.setText(currentProfile.getHeight());&#13;&#10;            editTextWeight.setText(currentProfile.getWeight());&#13;&#10;&#13;&#10;            // Convertir fecha de ISO (YYYY-MM-DD) a formato display (DD/MM/YYYY)&#13;&#10;            if (currentProfile.getBirthdate() != null &amp;&amp; !currentProfile.getBirthdate().isEmpty()) {&#13;&#10;                selectedBirthdate = currentProfile.getBirthdate();&#13;&#10;                String displayDate = formatDateForDisplay(currentProfile.getBirthdate());&#13;&#10;                editTextBirthdate.setText(displayDate);&#13;&#10;&#13;&#10;                // Actualizar el calendario&#13;&#10;                try {&#13;&#10;                    String[] parts = currentProfile.getBirthdate().split(&quot;-&quot;);&#13;&#10;                    if (parts.length == 3) {&#13;&#10;                        birthdateCalendar.set(Calendar.YEAR, Integer.parseInt(parts[0]));&#13;&#10;                        birthdateCalendar.set(Calendar.MONTH, Integer.parseInt(parts[1]) - 1);&#13;&#10;                        birthdateCalendar.set(Calendar.DAY_OF_MONTH, Integer.parseInt(parts[2]));&#13;&#10;                    }&#13;&#10;                } catch (Exception e) {&#13;&#10;                    Log.e(TAG, &quot;Error al parsear fecha: &quot; + e.getMessage());&#13;&#10;                }&#13;&#10;            }&#13;&#10;        } else if (&quot;agent&quot;.equalsIgnoreCase(profileType)) {&#13;&#10;            editTextLastName.setText(currentProfile.getLastName());&#13;&#10;            editTextAgency.setText(currentProfile.getAgency());&#13;&#10;        } else if (&quot;team&quot;.equalsIgnoreCase(profileType)) {&#13;&#10;            editTextLastName.setText(currentProfile.getJob());&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    private String formatDateForDisplay(String isoDate) {&#13;&#10;        // Convertir de YYYY-MM-DD a DD/MM/YYYY&#13;&#10;        if (isoDate != null &amp;&amp; isoDate.length() == 10) {&#13;&#10;            String[] parts = isoDate.split(&quot;-&quot;);&#13;&#10;            if (parts.length == 3) {&#13;&#10;                return parts[2] + &quot;/&quot; + parts[1] + &quot;/&quot; + parts[0];&#13;&#10;            }&#13;&#10;        }&#13;&#10;        return isoDate;&#13;&#10;    }&#13;&#10;&#13;&#10;    private void updateProfile() {&#13;&#10;        Log.d(TAG, &quot;updateProfile: Actualizando perfil&quot;);&#13;&#10;&#13;&#10;        loadingDialog.show(&quot;Actualizando perfil...&quot;);&#13;&#10;        buttonComplete.setEnabled(false);&#13;&#10;&#13;&#10;        threadManager.executeInBackground(new Runnable() {&#13;&#10;            @Override&#13;&#10;            public void run() {&#13;&#10;                // Crear el objeto UpdateProfileRequest con la estructura correcta&#13;&#10;                final UpdateProfileRequest updateRequest = new UpdateProfileRequest();&#13;&#10;&#13;&#10;                // Crear el objeto profileUpdates&#13;&#10;                UpdateProfileRequest.ProfileUpdates profileUpdates = new UpdateProfileRequest.ProfileUpdates();&#13;&#10;                profileUpdates.setName(editTextName.getText().toString().trim());&#13;&#10;                profileUpdates.setDescription(editTextDescription.getText().toString().trim());&#13;&#10;                profileUpdates.setPhoneNumber(editTextPhone.getText().toString().trim());&#13;&#10;                profileUpdates.setIgUser(editTextInstagram.getText().toString().trim());&#13;&#10;                profileUpdates.setxUser(editTextTwitter.getText().toString().trim());&#13;&#10;                profileUpdates.setLocationId(selectedLocationId);&#13;&#10;                profileUpdates.setSportId(selectedSportId);&#13;&#10;&#13;&#10;                // Campos específicos según el tipo de perfil&#13;&#10;                if (profileType.equalsIgnoreCase(&quot;athlete&quot;)) {&#13;&#10;                    profileUpdates.setLastName(editTextLastName.getText().toString().trim());&#13;&#10;                    profileUpdates.setBirthdate(selectedBirthdate);&#13;&#10;                    profileUpdates.setHeight(editTextHeight.getText().toString().trim());&#13;&#10;                    profileUpdates.setWeight(editTextWeight.getText().toString().trim());&#13;&#10;                } else if (profileType.equalsIgnoreCase(&quot;agent&quot;)) {&#13;&#10;                    profileUpdates.setLastName(editTextLastName.getText().toString().trim());&#13;&#10;                    profileUpdates.setAgency(editTextAgency.getText().toString().trim());&#13;&#10;                } else if (profileType.equalsIgnoreCase(&quot;team&quot;)) {&#13;&#10;                    profileUpdates.setJob(editTextLastName.getText().toString().trim());&#13;&#10;                }&#13;&#10;&#13;&#10;                // Establecer profileUpdates en el request&#13;&#10;                updateRequest.setProfileUpdates(profileUpdates);&#13;&#10;&#13;&#10;                Log.d(TAG, &quot;updateProfile: Enviando actualización al backend&quot;);&#13;&#10;&#13;&#10;                // Enviar al backend&#13;&#10;                authRepository.updateProfile(token, updateRequest, new Callback&lt;ProfileResponse&gt;() {&#13;&#10;                    @Override&#13;&#10;                    public void onResponse(Call&lt;ProfileResponse&gt; call, Response&lt;ProfileResponse&gt; response) {&#13;&#10;                        threadManager.executeOnMainThread(new Runnable() {&#13;&#10;                            @Override&#13;&#10;                            public void run() {&#13;&#10;                                loadingDialog.dismiss();&#13;&#10;                                buttonComplete.setEnabled(true);&#13;&#10;&#13;&#10;                                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#13;&#10;                                    Log.d(TAG, &quot;Perfil actualizado exitosamente&quot;);&#13;&#10;                                    Toast.makeText(ProfileFormActivity.this,&#13;&#10;                                        &quot;Perfil actualizado exitosamente&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;&#13;&#10;                                    // Volver a la pantalla anterior&#13;&#10;                                    finish();&#13;&#10;                                } else {&#13;&#10;                                    Log.e(TAG, &quot;Error al actualizar perfil - Status: &quot; + response.code());&#13;&#10;                                    String errorMsg = &quot;Error al actualizar perfil&quot;;&#13;&#10;&#13;&#10;                                    try {&#13;&#10;                                        if (response.errorBody() != null) {&#13;&#10;                                            String errorBody = response.errorBody().string();&#13;&#10;                                            Log.e(TAG, &quot;Error body: &quot; + errorBody);&#13;&#10;                                            if (errorBody.contains(&quot;message&quot;)) {&#13;&#10;                                                int start = errorBody.indexOf(&quot;\&quot;message\&quot;:\&quot;&quot;) + 11;&#13;&#10;                                                int end = errorBody.indexOf(&quot;\&quot;&quot;, start);&#13;&#10;                                                if (start &gt; 10 &amp;&amp; end &gt; start) {&#13;&#10;                                                    errorMsg = errorBody.substring(start, end);&#13;&#10;                                                }&#13;&#10;                                            }&#13;&#10;                                        }&#13;&#10;                                    } catch (Exception e) {&#13;&#10;                                        Log.e(TAG, &quot;Error al parsear error body: &quot; + e.getMessage());&#13;&#10;                                    }&#13;&#10;&#13;&#10;                                    Toast.makeText(ProfileFormActivity.this,&#13;&#10;                                        errorMsg, Toast.LENGTH_LONG).show();&#13;&#10;                                }&#13;&#10;                            }&#13;&#10;                        });&#13;&#10;                    }&#13;&#10;&#13;&#10;                    @Override&#13;&#10;                    public void onFailure(Call&lt;ProfileResponse&gt; call, Throwable t) {&#13;&#10;                        threadManager.executeOnMainThread(new Runnable() {&#13;&#10;                            @Override&#13;&#10;                            public void run() {&#13;&#10;                                loadingDialog.dismiss();&#13;&#10;                                buttonComplete.setEnabled(true);&#13;&#10;&#13;&#10;                                String errorMsg = t.getMessage();&#13;&#10;                                if (errorMsg == null || errorMsg.isEmpty()) {&#13;&#10;                                    errorMsg = &quot;Error desconocido&quot;;&#13;&#10;                                }&#13;&#10;                                Toast.makeText(ProfileFormActivity.this,&#13;&#10;                                    &quot;Error de conexión: &quot; + errorMsg, Toast.LENGTH_LONG).show();&#13;&#10;                            }&#13;&#10;                        });&#13;&#10;                    }&#13;&#10;                });&#13;&#10;            }&#13;&#10;        });&#13;&#10;    }&#13;&#10;&#13;&#10;    @Override&#13;&#10;    protected void onDestroy() {&#13;&#10;        super.onDestroy();&#13;&#10;        // Cerrar el diálogo si está abierto&#13;&#10;        if (loadingDialog != null &amp;&amp; loadingDialog.isShowing()) {&#13;&#10;            loadingDialog.dismiss();&#13;&#10;        }&#13;&#10;    }&#13;&#10;}&#13;&#10;&#13;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/sportconnection/fragments/ProfileFragment.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/sportconnection/fragments/ProfileFragment.java" />
              <option name="originalContent" value="package com.example.sportconnection.fragments;&#10;&#10;import android.content.Intent;&#10;import android.os.Bundle;&#10;import android.util.Log;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.Button;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.fragment.app.Fragment;&#10;&#10;import com.example.sportconnection.MainActivity;&#10;import com.example.sportconnection.ProfileFormActivity;&#10;import com.example.sportconnection.R;&#10;import com.example.sportconnection.model.Location;&#10;import com.example.sportconnection.model.GetProfileResponse;&#10;import com.example.sportconnection.model.Sport;&#10;import com.example.sportconnection.repository.AuthRepository;&#10;import com.example.sportconnection.repository.LookupRepository;&#10;import com.example.sportconnection.utils.LoadingDialog;&#10;import com.example.sportconnection.utils.SessionManager;&#10;import com.example.sportconnection.utils.ThreadManager;&#10;&#10;import java.util.List;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class ProfileFragment extends Fragment {&#10;    private static final String TAG = &quot;ProfileFragment&quot;;&#10;&#10;    private TextView textUserEmail;&#10;    private TextView textUserType;&#10;    private TextView textUserName;&#10;    private TextView textUserLastName;&#10;    private TextView textUserBirthdate;&#10;    private TextView textUserHeight;&#10;    private TextView textUserWeight;&#10;    private TextView textUserLocation;&#10;    private TextView textUserSport;&#10;    private TextView textUserPhone;&#10;    private TextView textUserInstagram;&#10;    private TextView textUserTwitter;&#10;    private TextView textUserAgency;&#10;    private TextView textUserJob;&#10;    private TextView textUserDescription;&#10;    private Button buttonEditProfile;&#10;    private Button buttonLogout;&#10;&#10;    private SessionManager sessionManager;&#10;    private AuthRepository authRepository;&#10;    private LookupRepository lookupRepository;&#10;    private LoadingDialog loadingDialog;&#10;    private ThreadManager threadManager;&#10;&#10;    private GetProfileResponse.ProfileData currentProfile;&#10;    private String currentProfileType; // Tipo de perfil del nivel superior de la respuesta&#10;    private List&lt;Sport&gt; sportList;&#10;    private List&lt;Location&gt; locationList;&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {&#10;        View view = inflater.inflate(R.layout.fragment_profile, container, false);&#10;&#10;        // Inicializar vistas&#10;        textUserEmail = view.findViewById(R.id.textUserEmail);&#10;        textUserType = view.findViewById(R.id.textUserType);&#10;        textUserName = view.findViewById(R.id.textUserName);&#10;        textUserLastName = view.findViewById(R.id.textUserLastName);&#10;        textUserBirthdate = view.findViewById(R.id.textUserBirthdate);&#10;        textUserHeight = view.findViewById(R.id.textUserHeight);&#10;        textUserWeight = view.findViewById(R.id.textUserWeight);&#10;        textUserLocation = view.findViewById(R.id.textUserLocation);&#10;        textUserSport = view.findViewById(R.id.textUserSport);&#10;        textUserPhone = view.findViewById(R.id.textUserPhone);&#10;        textUserInstagram = view.findViewById(R.id.textUserInstagram);&#10;        textUserTwitter = view.findViewById(R.id.textUserTwitter);&#10;        textUserAgency = view.findViewById(R.id.textUserAgency);&#10;        textUserJob = view.findViewById(R.id.textUserJob);&#10;        textUserDescription = view.findViewById(R.id.textUserDescription);&#10;        buttonEditProfile = view.findViewById(R.id.buttonEditProfile);&#10;        buttonLogout = view.findViewById(R.id.buttonLogout);&#10;&#10;        // Inicializar utilidades&#10;        sessionManager = new SessionManager(requireContext());&#10;        authRepository = new AuthRepository();&#10;        lookupRepository = new LookupRepository();&#10;        loadingDialog = new LoadingDialog(requireContext());&#10;        threadManager = ThreadManager.getInstance();&#10;&#10;        // Cargar información del usuario&#10;        loadUserProfile();&#10;&#10;        // Configurar botón de editar perfil&#10;        buttonEditProfile.setOnClickListener(new View.OnClickListener() {&#10;            @Override&#10;            public void onClick(View v) {&#10;                if (currentProfile != null) {&#10;                    openEditProfile();&#10;                } else {&#10;                    Toast.makeText(requireContext(), &quot;Cargando información del perfil...&quot;, Toast.LENGTH_SHORT).show();&#10;                }&#10;            }&#10;        });&#10;&#10;        // Configurar botón de cerrar sesión&#10;        buttonLogout.setOnClickListener(new View.OnClickListener() {&#10;            @Override&#10;            public void onClick(View v) {&#10;                logoutUser();&#10;            }&#10;        });&#10;&#10;        return view;&#10;    }&#10;&#10;    private void loadUserProfile() {&#10;        loadingDialog.show(&quot;Cargando perfil...&quot;);&#10;&#10;        final String token = sessionManager.getToken();&#10;        final int userId = sessionManager.getUserId();&#10;&#10;        if (token == null || userId == -1) {&#10;            loadingDialog.dismiss();&#10;            Toast.makeText(requireContext(), &quot;Error: Sesión no válida&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        Log.d(TAG, &quot;Cargando perfil para userId: &quot; + userId);&#10;&#10;        // Cargar sports y locations primero&#10;        loadLookupsData(new Runnable() {&#10;            @Override&#10;            public void run() {&#10;                // Una vez cargados los lookups, cargar el perfil&#10;                authRepository.getProfile(token, new Callback&lt;GetProfileResponse&gt;() {&#10;                    @Override&#10;                    public void onResponse(Call&lt;GetProfileResponse&gt; call, Response&lt;GetProfileResponse&gt; response) {&#10;                        loadingDialog.dismiss();&#10;&#10;                        if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                            GetProfileResponse profileResponse = response.body();&#10;                            if (profileResponse.getProfile() != null) {&#10;                                currentProfile = profileResponse.getProfile();&#10;                                currentProfileType = profileResponse.getProfileType(); // Guardar el tipo de perfil&#10;                                displayProfileData();&#10;                            } else {&#10;                                Toast.makeText(requireContext(), &quot;Error: Perfil no encontrado&quot;, Toast.LENGTH_SHORT).show();&#10;                            }&#10;                        } else {&#10;                            Log.e(TAG, &quot;Error al cargar perfil: &quot; + response.code());&#10;                            Toast.makeText(requireContext(), &quot;Error al cargar el perfil&quot;, Toast.LENGTH_SHORT).show();&#10;                        }&#10;                    }&#10;&#10;                    @Override&#10;                    public void onFailure(Call&lt;GetProfileResponse&gt; call, Throwable t) {&#10;                        loadingDialog.dismiss();&#10;                        Log.e(TAG, &quot;Error de conexión: &quot; + t.getMessage());&#10;                        Toast.makeText(requireContext(), &quot;Error de conexión&quot;, Toast.LENGTH_SHORT).show();&#10;                    }&#10;                });&#10;            }&#10;        });&#10;    }&#10;&#10;    private void loadLookupsData(final Runnable onComplete) {&#10;        // Cargar deportes&#10;        lookupRepository.getSports(new Callback&lt;List&lt;Sport&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;List&lt;Sport&gt;&gt; call, Response&lt;List&lt;Sport&gt;&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    sportList = response.body();&#10;                    checkLookupsLoaded(onComplete);&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;List&lt;Sport&gt;&gt; call, Throwable t) {&#10;                Log.e(TAG, &quot;Error al cargar sports: &quot; + t.getMessage());&#10;            }&#10;        });&#10;&#10;        // Cargar ubicaciones&#10;        lookupRepository.getLocations(new Callback&lt;List&lt;Location&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;List&lt;Location&gt;&gt; call, Response&lt;List&lt;Location&gt;&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    locationList = response.body();&#10;                    checkLookupsLoaded(onComplete);&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;List&lt;Location&gt;&gt; call, Throwable t) {&#10;                Log.e(TAG, &quot;Error al cargar locations: &quot; + t.getMessage());&#10;            }&#10;        });&#10;    }&#10;&#10;    private void checkLookupsLoaded(Runnable onComplete) {&#10;        if (sportList != null &amp;&amp; locationList != null &amp;&amp; onComplete != null) {&#10;            onComplete.run();&#10;        }&#10;    }&#10;&#10;    private void displayProfileData() {&#10;        if (currentProfile == null) return;&#10;&#10;        String email = sessionManager.getEmail();&#10;        String profileType = currentProfileType; // Usar el profileType guardado del nivel superior&#10;&#10;        textUserEmail.setText(&quot;Email: &quot; + (email != null ? email : &quot;No disponible&quot;));&#10;&#10;        // Traducir el tipo de perfil&#10;        String profileTypeText = &quot;No disponible&quot;;&#10;        if (profileType != null) {&#10;            switch (profileType.toLowerCase()) {&#10;                case &quot;athlete&quot;:&#10;                    profileTypeText = &quot;Atleta&quot;;&#10;                    break;&#10;                case &quot;agent&quot;:&#10;                    profileTypeText = &quot;Agente&quot;;&#10;                    break;&#10;                case &quot;team&quot;:&#10;                    profileTypeText = &quot;Equipo&quot;;&#10;                    break;&#10;                default:&#10;                    profileTypeText = profileType;&#10;            }&#10;        }&#10;        textUserType.setText(&quot;Tipo: &quot; + profileTypeText);&#10;&#10;        // Información común&#10;        textUserName.setText(&quot;Nombre: &quot; + (currentProfile.getName() != null ? currentProfile.getName() : &quot;No disponible&quot;));&#10;&#10;        if (currentProfile.getLastName() != null &amp;&amp; !currentProfile.getLastName().isEmpty()) {&#10;            textUserLastName.setVisibility(View.VISIBLE);&#10;            textUserLastName.setText(&quot;Apellido: &quot; + currentProfile.getLastName());&#10;        }&#10;&#10;        // Ubicación&#10;        String locationText = &quot;No disponible&quot;;&#10;        if (currentProfile.getLocationId() != null &amp;&amp; locationList != null) {&#10;            for (Location location : locationList) {&#10;                if (location.getId() == currentProfile.getLocationId()) {&#10;                    locationText = location.toString();&#10;                    break;&#10;                }&#10;            }&#10;        }&#10;        textUserLocation.setText(&quot;Ubicación: &quot; + locationText);&#10;&#10;        // Deporte&#10;        String sportText = &quot;No disponible&quot;;&#10;        if (currentProfile.getSportId() != null &amp;&amp; sportList != null) {&#10;            for (Sport sport : sportList) {&#10;                if (sport.getId() == currentProfile.getSportId()) {&#10;                    sportText = sport.getName();&#10;                    break;&#10;                }&#10;            }&#10;        }&#10;        textUserSport.setText(&quot;Deporte: &quot; + sportText);&#10;&#10;        textUserPhone.setText(&quot;Teléfono: &quot; + (currentProfile.getPhoneNumber() != null ? currentProfile.getPhoneNumber() : &quot;No disponible&quot;));&#10;&#10;        if (currentProfile.getIgUser() != null &amp;&amp; !currentProfile.getIgUser().isEmpty()) {&#10;            textUserInstagram.setVisibility(View.VISIBLE);&#10;            textUserInstagram.setText(&quot;Instagram: &quot; + currentProfile.getIgUser());&#10;        }&#10;&#10;        if (currentProfile.getxUser() != null &amp;&amp; !currentProfile.getxUser().isEmpty()) {&#10;            textUserTwitter.setVisibility(View.VISIBLE);&#10;            textUserTwitter.setText(&quot;X (Twitter): &quot; + currentProfile.getxUser());&#10;        }&#10;&#10;        if (currentProfile.getDescription() != null &amp;&amp; !currentProfile.getDescription().isEmpty()) {&#10;            textUserDescription.setVisibility(View.VISIBLE);&#10;            textUserDescription.setText(&quot;Descripción: &quot; + currentProfile.getDescription());&#10;        }&#10;&#10;        // Campos específicos por tipo de perfil&#10;        if (&quot;athlete&quot;.equalsIgnoreCase(profileType)) {&#10;            if (currentProfile.getBirthdate() != null &amp;&amp; !currentProfile.getBirthdate().isEmpty()) {&#10;                textUserBirthdate.setVisibility(View.VISIBLE);&#10;                textUserBirthdate.setText(&quot;Fecha de nacimiento: &quot; + formatDate(currentProfile.getBirthdate()));&#10;            }&#10;&#10;            if (currentProfile.getHeight() != null &amp;&amp; !currentProfile.getHeight().isEmpty()) {&#10;                textUserHeight.setVisibility(View.VISIBLE);&#10;                textUserHeight.setText(&quot;Altura: &quot; + currentProfile.getHeight() + &quot; cm&quot;);&#10;            }&#10;&#10;            if (currentProfile.getWeight() != null &amp;&amp; !currentProfile.getWeight().isEmpty()) {&#10;                textUserWeight.setVisibility(View.VISIBLE);&#10;                textUserWeight.setText(&quot;Peso: &quot; + currentProfile.getWeight() + &quot; kg&quot;);&#10;            }&#10;        } else if (&quot;agent&quot;.equalsIgnoreCase(profileType)) {&#10;            if (currentProfile.getAgency() != null &amp;&amp; !currentProfile.getAgency().isEmpty()) {&#10;                textUserAgency.setVisibility(View.VISIBLE);&#10;                textUserAgency.setText(&quot;Agencia: &quot; + currentProfile.getAgency());&#10;            }&#10;        } else if (&quot;team&quot;.equalsIgnoreCase(profileType)) {&#10;            if (currentProfile.getJob() != null &amp;&amp; !currentProfile.getJob().isEmpty()) {&#10;                textUserJob.setVisibility(View.VISIBLE);&#10;                textUserJob.setText(&quot;Puesto: &quot; + currentProfile.getJob());&#10;            }&#10;        }&#10;    }&#10;&#10;    private String formatDate(String isoDate) {&#10;        // Convertir de YYYY-MM-DD a DD/MM/YYYY&#10;        if (isoDate != null &amp;&amp; isoDate.length() == 10) {&#10;            String[] parts = isoDate.split(&quot;-&quot;);&#10;            if (parts.length == 3) {&#10;                return parts[2] + &quot;/&quot; + parts[1] + &quot;/&quot; + parts[0];&#10;            }&#10;        }&#10;        return isoDate;&#10;    }&#10;&#10;    private void openEditProfile() {&#10;        Intent intent = new Intent(requireActivity(), ProfileFormActivity.class);&#10;        intent.putExtra(&quot;isEditMode&quot;, true);&#10;        intent.putExtra(&quot;profileType&quot;, currentProfileType);&#10;        Log.d(TAG, &quot;Abriendo formulario de edición con profileType: &quot; + currentProfileType);&#10;        startActivity(intent);&#10;    }&#10;&#10;    @Override&#10;    public void onResume() {&#10;        super.onResume();&#10;        // Recargar el perfil cuando volvemos a este fragment&#10;        if (currentProfile != null) {&#10;            loadUserProfile();&#10;        }&#10;    }&#10;&#10;    private void logoutUser() {&#10;        loadingDialog.show(&quot;Cerrando sesión...&quot;);&#10;        buttonLogout.setEnabled(false);&#10;&#10;        threadManager.executeInBackground(new Runnable() {&#10;            @Override&#10;            public void run() {&#10;                // Cerrar sesión&#10;                sessionManager.logout();&#10;&#10;                // Pequeño delay para dar feedback visual&#10;                try {&#10;                    Thread.sleep(500);&#10;                } catch (InterruptedException e) {&#10;                    e.printStackTrace();&#10;                }&#10;&#10;                // Redirigir a MainActivity en el hilo principal&#10;                threadManager.executeOnMainThread(new Runnable() {&#10;                    @Override&#10;                    public void run() {&#10;                        loadingDialog.dismiss();&#10;&#10;                        Intent intent = new Intent(requireActivity(), MainActivity.class);&#10;                        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);&#10;                        startActivity(intent);&#10;                        requireActivity().finish();&#10;                    }&#10;                });&#10;            }&#10;        });&#10;    }&#10;&#10;    @Override&#10;    public void onDestroyView() {&#10;        super.onDestroyView();&#10;        // Cerrar el diálogo si está abierto&#10;        if (loadingDialog != null &amp;&amp; loadingDialog.isShowing()) {&#10;            loadingDialog.dismiss();&#10;        }&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.sportconnection.fragments;&#13;&#10;&#13;&#10;import android.content.Intent;&#13;&#10;import android.os.Bundle;&#13;&#10;import android.util.Log;&#13;&#10;import android.view.LayoutInflater;&#13;&#10;import android.view.View;&#13;&#10;import android.view.ViewGroup;&#13;&#10;import android.widget.Button;&#13;&#10;import android.widget.TextView;&#13;&#10;import android.widget.Toast;&#13;&#10;&#13;&#10;import androidx.annotation.NonNull;&#13;&#10;import androidx.annotation.Nullable;&#13;&#10;import androidx.fragment.app.Fragment;&#13;&#10;&#13;&#10;import com.example.sportconnection.MainActivity;&#13;&#10;import com.example.sportconnection.ProfileFormActivity;&#13;&#10;import com.example.sportconnection.R;&#13;&#10;import com.example.sportconnection.model.Location;&#13;&#10;import com.example.sportconnection.model.GetProfileResponse;&#13;&#10;import com.example.sportconnection.model.Sport;&#13;&#10;import com.example.sportconnection.repository.AuthRepository;&#13;&#10;import com.example.sportconnection.repository.LookupRepository;&#13;&#10;import com.example.sportconnection.utils.LoadingDialog;&#13;&#10;import com.example.sportconnection.utils.SessionManager;&#13;&#10;import com.example.sportconnection.utils.ThreadManager;&#13;&#10;&#13;&#10;import java.util.List;&#13;&#10;&#13;&#10;import retrofit2.Call;&#13;&#10;import retrofit2.Callback;&#13;&#10;import retrofit2.Response;&#13;&#10;&#13;&#10;public class ProfileFragment extends Fragment {&#13;&#10;    private static final String TAG = &quot;ProfileFragment&quot;;&#13;&#10;&#13;&#10;    private TextView textUserEmail;&#13;&#10;    private TextView textUserType;&#13;&#10;    private TextView textUserName;&#13;&#10;    private TextView textUserLastName;&#13;&#10;    private TextView textUserBirthdate;&#13;&#10;    private TextView textUserHeight;&#13;&#10;    private TextView textUserWeight;&#13;&#10;    private TextView textUserLocation;&#13;&#10;    private TextView textUserSport;&#13;&#10;    private TextView textUserPhone;&#13;&#10;    private TextView textUserInstagram;&#13;&#10;    private TextView textUserTwitter;&#13;&#10;    private TextView textUserAgency;&#13;&#10;    private TextView textUserJob;&#13;&#10;    private TextView textUserDescription;&#13;&#10;    private Button buttonEditProfile;&#13;&#10;    private Button buttonLogout;&#13;&#10;&#13;&#10;    private SessionManager sessionManager;&#13;&#10;    private AuthRepository authRepository;&#13;&#10;    private LookupRepository lookupRepository;&#13;&#10;    private LoadingDialog loadingDialog;&#13;&#10;    private ThreadManager threadManager;&#13;&#10;&#13;&#10;    private GetProfileResponse.ProfileData currentProfile;&#13;&#10;    private String currentProfileType; // Tipo de perfil del nivel superior de la respuesta&#13;&#10;    private List&lt;Sport&gt; sportList;&#13;&#10;    private List&lt;Location&gt; locationList;&#13;&#10;&#13;&#10;    @Nullable&#13;&#10;    @Override&#13;&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {&#13;&#10;        View view = inflater.inflate(R.layout.fragment_profile, container, false);&#13;&#10;&#13;&#10;        // Inicializar vistas&#13;&#10;        textUserEmail = view.findViewById(R.id.textUserEmail);&#13;&#10;        textUserType = view.findViewById(R.id.textUserType);&#13;&#10;        textUserName = view.findViewById(R.id.textUserName);&#13;&#10;        textUserLastName = view.findViewById(R.id.textUserLastName);&#13;&#10;        textUserBirthdate = view.findViewById(R.id.textUserBirthdate);&#13;&#10;        textUserHeight = view.findViewById(R.id.textUserHeight);&#13;&#10;        textUserWeight = view.findViewById(R.id.textUserWeight);&#13;&#10;        textUserLocation = view.findViewById(R.id.textUserLocation);&#13;&#10;        textUserSport = view.findViewById(R.id.textUserSport);&#13;&#10;        textUserPhone = view.findViewById(R.id.textUserPhone);&#13;&#10;        textUserInstagram = view.findViewById(R.id.textUserInstagram);&#13;&#10;        textUserTwitter = view.findViewById(R.id.textUserTwitter);&#13;&#10;        textUserAgency = view.findViewById(R.id.textUserAgency);&#13;&#10;        textUserJob = view.findViewById(R.id.textUserJob);&#13;&#10;        textUserDescription = view.findViewById(R.id.textUserDescription);&#13;&#10;        buttonEditProfile = view.findViewById(R.id.buttonEditProfile);&#13;&#10;        buttonLogout = view.findViewById(R.id.buttonLogout);&#13;&#10;&#13;&#10;        // Inicializar utilidades&#13;&#10;        sessionManager = new SessionManager(requireContext());&#13;&#10;        authRepository = new AuthRepository();&#13;&#10;        lookupRepository = new LookupRepository();&#13;&#10;        loadingDialog = new LoadingDialog(requireContext());&#13;&#10;        threadManager = ThreadManager.getInstance();&#13;&#10;&#13;&#10;        // Cargar información del usuario&#13;&#10;        loadUserProfile();&#13;&#10;&#13;&#10;        // Configurar botón de editar perfil&#13;&#10;        buttonEditProfile.setOnClickListener(new View.OnClickListener() {&#13;&#10;            @Override&#13;&#10;            public void onClick(View v) {&#13;&#10;                if (currentProfile != null) {&#13;&#10;                    openEditProfile();&#13;&#10;                } else {&#13;&#10;                    Toast.makeText(requireContext(), &quot;Cargando información del perfil...&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;                }&#13;&#10;            }&#13;&#10;        });&#13;&#10;&#13;&#10;        // Configurar botón de cerrar sesión&#13;&#10;        buttonLogout.setOnClickListener(new View.OnClickListener() {&#13;&#10;            @Override&#13;&#10;            public void onClick(View v) {&#13;&#10;                logoutUser();&#13;&#10;            }&#13;&#10;        });&#13;&#10;&#13;&#10;        return view;&#13;&#10;    }&#13;&#10;&#13;&#10;    private void loadUserProfile() {&#13;&#10;        loadingDialog.show(&quot;Cargando perfil...&quot;);&#13;&#10;&#13;&#10;        final String token = sessionManager.getToken();&#13;&#10;        final int userId = sessionManager.getUserId();&#13;&#10;&#13;&#10;        if (token == null || userId == -1) {&#13;&#10;            loadingDialog.dismiss();&#13;&#10;            Toast.makeText(requireContext(), &quot;Error: Sesión no válida&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;            return;&#13;&#10;        }&#13;&#10;&#13;&#10;        Log.d(TAG, &quot;Cargando perfil para userId: &quot; + userId);&#13;&#10;&#13;&#10;        // Cargar sports y locations primero&#13;&#10;        loadLookupsData(new Runnable() {&#13;&#10;            @Override&#13;&#10;            public void run() {&#13;&#10;                // Una vez cargados los lookups, cargar el perfil&#13;&#10;                authRepository.getProfile(token, new Callback&lt;GetProfileResponse&gt;() {&#13;&#10;                    @Override&#13;&#10;                    public void onResponse(Call&lt;GetProfileResponse&gt; call, Response&lt;GetProfileResponse&gt; response) {&#13;&#10;                        loadingDialog.dismiss();&#13;&#10;&#13;&#10;                        if (response.isSuccessful() &amp;&amp; response.body() != null) {&#13;&#10;                            GetProfileResponse profileResponse = response.body();&#13;&#10;                            if (profileResponse.getProfile() != null) {&#13;&#10;                                currentProfile = profileResponse.getProfile();&#13;&#10;                                currentProfileType = profileResponse.getProfileType(); // Guardar el tipo de perfil&#13;&#10;                                displayProfileData();&#13;&#10;                            } else {&#13;&#10;                                Toast.makeText(requireContext(), &quot;Error: Perfil no encontrado&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;                            }&#13;&#10;                        } else {&#13;&#10;                            Log.e(TAG, &quot;Error al cargar perfil: &quot; + response.code());&#13;&#10;                            Toast.makeText(requireContext(), &quot;Error al cargar el perfil&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;                        }&#13;&#10;                    }&#13;&#10;&#13;&#10;                    @Override&#13;&#10;                    public void onFailure(Call&lt;GetProfileResponse&gt; call, Throwable t) {&#13;&#10;                        loadingDialog.dismiss();&#13;&#10;                        Log.e(TAG, &quot;Error de conexión: &quot; + t.getMessage());&#13;&#10;                        Toast.makeText(requireContext(), &quot;Error de conexión&quot;, Toast.LENGTH_SHORT).show();&#13;&#10;                    }&#13;&#10;                });&#13;&#10;            }&#13;&#10;        });&#13;&#10;    }&#13;&#10;&#13;&#10;    private void loadLookupsData(final Runnable onComplete) {&#13;&#10;        // Cargar deportes&#13;&#10;        lookupRepository.getSports(new Callback&lt;List&lt;Sport&gt;&gt;() {&#13;&#10;            @Override&#13;&#10;            public void onResponse(Call&lt;List&lt;Sport&gt;&gt; call, Response&lt;List&lt;Sport&gt;&gt; response) {&#13;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#13;&#10;                    sportList = response.body();&#13;&#10;                    checkLookupsLoaded(onComplete);&#13;&#10;                }&#13;&#10;            }&#13;&#10;&#13;&#10;            @Override&#13;&#10;            public void onFailure(Call&lt;List&lt;Sport&gt;&gt; call, Throwable t) {&#13;&#10;                Log.e(TAG, &quot;Error al cargar sports: &quot; + t.getMessage());&#13;&#10;            }&#13;&#10;        });&#13;&#10;&#13;&#10;        // Cargar ubicaciones&#13;&#10;        lookupRepository.getLocations(new Callback&lt;List&lt;Location&gt;&gt;() {&#13;&#10;            @Override&#13;&#10;            public void onResponse(Call&lt;List&lt;Location&gt;&gt; call, Response&lt;List&lt;Location&gt;&gt; response) {&#13;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#13;&#10;                    locationList = response.body();&#13;&#10;                    checkLookupsLoaded(onComplete);&#13;&#10;                }&#13;&#10;            }&#13;&#10;&#13;&#10;            @Override&#13;&#10;            public void onFailure(Call&lt;List&lt;Location&gt;&gt; call, Throwable t) {&#13;&#10;                Log.e(TAG, &quot;Error al cargar locations: &quot; + t.getMessage());&#13;&#10;            }&#13;&#10;        });&#13;&#10;    }&#13;&#10;&#13;&#10;    private void checkLookupsLoaded(Runnable onComplete) {&#13;&#10;        if (sportList != null &amp;&amp; locationList != null &amp;&amp; onComplete != null) {&#13;&#10;            onComplete.run();&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    private void displayProfileData() {&#13;&#10;        if (currentProfile == null) return;&#13;&#10;&#13;&#10;        String email = sessionManager.getEmail();&#13;&#10;        String profileType = currentProfileType; // Usar el profileType guardado del nivel superior&#13;&#10;&#13;&#10;        textUserEmail.setText(&quot;Email: &quot; + (email != null ? email : &quot;No disponible&quot;));&#13;&#10;&#13;&#10;        // Traducir el tipo de perfil&#13;&#10;        String profileTypeText = &quot;No disponible&quot;;&#13;&#10;        if (profileType != null) {&#13;&#10;            switch (profileType.toLowerCase()) {&#13;&#10;                case &quot;athlete&quot;:&#13;&#10;                    profileTypeText = &quot;Atleta&quot;;&#13;&#10;                    break;&#13;&#10;                case &quot;agent&quot;:&#13;&#10;                    profileTypeText = &quot;Agente&quot;;&#13;&#10;                    break;&#13;&#10;                case &quot;team&quot;:&#13;&#10;                    profileTypeText = &quot;Equipo&quot;;&#13;&#10;                    break;&#13;&#10;                default:&#13;&#10;                    profileTypeText = profileType;&#13;&#10;            }&#13;&#10;        }&#13;&#10;        textUserType.setText(&quot;Tipo: &quot; + profileTypeText);&#13;&#10;&#13;&#10;        // Información común&#13;&#10;        textUserName.setText(&quot;Nombre: &quot; + (currentProfile.getName() != null ? currentProfile.getName() : &quot;No disponible&quot;));&#13;&#10;&#13;&#10;        if (currentProfile.getLastName() != null &amp;&amp; !currentProfile.getLastName().isEmpty()) {&#13;&#10;            textUserLastName.setVisibility(View.VISIBLE);&#13;&#10;            textUserLastName.setText(&quot;Apellido: &quot; + currentProfile.getLastName());&#13;&#10;        }&#13;&#10;&#13;&#10;        // Ubicación&#13;&#10;        String locationText = &quot;No disponible&quot;;&#13;&#10;        if (currentProfile.getLocationId() != null &amp;&amp; locationList != null) {&#13;&#10;            for (Location location : locationList) {&#13;&#10;                if (location.getId() == currentProfile.getLocationId()) {&#13;&#10;                    locationText = location.toString();&#13;&#10;                    break;&#13;&#10;                }&#13;&#10;            }&#13;&#10;        }&#13;&#10;        textUserLocation.setText(&quot;Ubicación: &quot; + locationText);&#13;&#10;&#13;&#10;        // Deporte&#13;&#10;        String sportText = &quot;No disponible&quot;;&#13;&#10;        if (currentProfile.getSportId() != null &amp;&amp; sportList != null) {&#13;&#10;            for (Sport sport : sportList) {&#13;&#10;                if (sport.getId() == currentProfile.getSportId()) {&#13;&#10;                    sportText = sport.getName();&#13;&#10;                    break;&#13;&#10;                }&#13;&#10;            }&#13;&#10;        }&#13;&#10;        textUserSport.setText(&quot;Deporte: &quot; + sportText);&#13;&#10;&#13;&#10;        textUserPhone.setText(&quot;Teléfono: &quot; + (currentProfile.getPhoneNumber() != null ? currentProfile.getPhoneNumber() : &quot;No disponible&quot;));&#13;&#10;&#13;&#10;        if (currentProfile.getIgUser() != null &amp;&amp; !currentProfile.getIgUser().isEmpty()) {&#13;&#10;            textUserInstagram.setVisibility(View.VISIBLE);&#13;&#10;            textUserInstagram.setText(&quot;Instagram: &quot; + currentProfile.getIgUser());&#13;&#10;        }&#13;&#10;&#13;&#10;        if (currentProfile.getxUser() != null &amp;&amp; !currentProfile.getxUser().isEmpty()) {&#13;&#10;            textUserTwitter.setVisibility(View.VISIBLE);&#13;&#10;            textUserTwitter.setText(&quot;X (Twitter): &quot; + currentProfile.getxUser());&#13;&#10;        }&#13;&#10;&#13;&#10;        if (currentProfile.getDescription() != null &amp;&amp; !currentProfile.getDescription().isEmpty()) {&#13;&#10;            textUserDescription.setVisibility(View.VISIBLE);&#13;&#10;            textUserDescription.setText(&quot;Descripción: &quot; + currentProfile.getDescription());&#13;&#10;        }&#13;&#10;&#13;&#10;        // Campos específicos por tipo de perfil&#13;&#10;        if (&quot;athlete&quot;.equalsIgnoreCase(profileType)) {&#13;&#10;            if (currentProfile.getBirthdate() != null &amp;&amp; !currentProfile.getBirthdate().isEmpty()) {&#13;&#10;                textUserBirthdate.setVisibility(View.VISIBLE);&#13;&#10;                textUserBirthdate.setText(&quot;Fecha de nacimiento: &quot; + formatDate(currentProfile.getBirthdate()));&#13;&#10;            }&#13;&#10;&#13;&#10;            if (currentProfile.getHeight() != null &amp;&amp; !currentProfile.getHeight().isEmpty()) {&#13;&#10;                textUserHeight.setVisibility(View.VISIBLE);&#13;&#10;                textUserHeight.setText(&quot;Altura: &quot; + currentProfile.getHeight() + &quot; cm&quot;);&#13;&#10;            }&#13;&#10;&#13;&#10;            if (currentProfile.getWeight() != null &amp;&amp; !currentProfile.getWeight().isEmpty()) {&#13;&#10;                textUserWeight.setVisibility(View.VISIBLE);&#13;&#10;                textUserWeight.setText(&quot;Peso: &quot; + currentProfile.getWeight() + &quot; kg&quot;);&#13;&#10;            }&#13;&#10;        } else if (&quot;agent&quot;.equalsIgnoreCase(profileType)) {&#13;&#10;            if (currentProfile.getAgency() != null &amp;&amp; !currentProfile.getAgency().isEmpty()) {&#13;&#10;                textUserAgency.setVisibility(View.VISIBLE);&#13;&#10;                textUserAgency.setText(&quot;Agencia: &quot; + currentProfile.getAgency());&#13;&#10;            }&#13;&#10;        } else if (&quot;team&quot;.equalsIgnoreCase(profileType)) {&#13;&#10;            if (currentProfile.getJob() != null &amp;&amp; !currentProfile.getJob().isEmpty()) {&#13;&#10;                textUserJob.setVisibility(View.VISIBLE);&#13;&#10;                textUserJob.setText(&quot;Puesto: &quot; + currentProfile.getJob());&#13;&#10;            }&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    private String formatDate(String isoDate) {&#13;&#10;        // Convertir de YYYY-MM-DD a DD/MM/YYYY&#13;&#10;        if (isoDate != null &amp;&amp; isoDate.length() == 10) {&#13;&#10;            String[] parts = isoDate.split(&quot;-&quot;);&#13;&#10;            if (parts.length == 3) {&#13;&#10;                return parts[2] + &quot;/&quot; + parts[1] + &quot;/&quot; + parts[0];&#13;&#10;            }&#13;&#10;        }&#13;&#10;        return isoDate;&#13;&#10;    }&#13;&#10;&#13;&#10;    private void openEditProfile() {&#10;        Intent intent = new Intent(requireActivity(), ProfileFormActivity.class);&#10;        intent.putExtra(&quot;isEditMode&quot;, true);&#10;        intent.putExtra(&quot;profileType&quot;, currentProfileType);&#10;        Log.d(TAG, &quot;Abriendo formulario de edición con profileType: &quot; + currentProfileType);&#10;        startActivity(intent);&#10;    }&#13;&#10;&#13;&#10;    @Override&#13;&#10;    public void onResume() {&#13;&#10;        super.onResume();&#13;&#10;        // Recargar el perfil cuando volvemos a este fragment&#13;&#10;        if (currentProfile != null) {&#13;&#10;            loadUserProfile();&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    private void logoutUser() {&#13;&#10;        loadingDialog.show(&quot;Cerrando sesión...&quot;);&#13;&#10;        buttonLogout.setEnabled(false);&#13;&#10;&#13;&#10;        threadManager.executeInBackground(new Runnable() {&#13;&#10;            @Override&#13;&#10;            public void run() {&#13;&#10;                // Cerrar sesión&#13;&#10;                sessionManager.logout();&#13;&#10;&#13;&#10;                // Pequeño delay para dar feedback visual&#13;&#10;                try {&#13;&#10;                    Thread.sleep(500);&#13;&#10;                } catch (InterruptedException e) {&#13;&#10;                    e.printStackTrace();&#13;&#10;                }&#13;&#10;&#13;&#10;                // Redirigir a MainActivity en el hilo principal&#13;&#10;                threadManager.executeOnMainThread(new Runnable() {&#13;&#10;                    @Override&#13;&#10;                    public void run() {&#13;&#10;                        loadingDialog.dismiss();&#13;&#10;&#13;&#10;                        Intent intent = new Intent(requireActivity(), MainActivity.class);&#13;&#10;                        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);&#13;&#10;                        startActivity(intent);&#13;&#10;                        requireActivity().finish();&#13;&#10;                    }&#13;&#10;                });&#13;&#10;            }&#13;&#10;        });&#13;&#10;    }&#13;&#10;&#13;&#10;    @Override&#13;&#10;    public void onDestroyView() {&#13;&#10;        super.onDestroyView();&#13;&#10;        // Cerrar el diálogo si está abierto&#13;&#10;        if (loadingDialog != null &amp;&amp; loadingDialog.isShowing()) {&#13;&#10;            loadingDialog.dismiss();&#13;&#10;        }&#13;&#10;    }&#13;&#10;}&#13;&#10;&#13;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/sportconnection/model/RegisterRequest.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/sportconnection/model/RegisterRequest.java" />
              <option name="updatedContent" value="package com.example.sportconnection.model;&#10;&#10;public class RegisterRequest {&#10;    private String email;&#10;    private String password;&#10;&#10;    public RegisterRequest(String email, String password) {&#10;        this.email = email;&#10;        this.password = password;&#10;    }&#10;&#10;    public String getEmail() {&#10;        return email;&#10;    }&#10;&#10;    public void setEmail(String email) {&#10;        this.email = email;&#10;    }&#10;&#10;    public String getPassword() {&#10;        return password;&#10;    }&#10;&#10;    public void setPassword(String password) {&#10;        this.password = password;&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/sportconnection/model/RegisterResponse.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/sportconnection/model/RegisterResponse.java" />
              <option name="updatedContent" value="package com.example.sportconnection.model;&#10;&#10;public class RegisterResponse {&#10;    private boolean success;&#10;    private String message;&#10;    private String token;&#10;    private int userId;&#10;&#10;    public boolean isSuccess() {&#10;        return success;&#10;    }&#10;&#10;    public void setSuccess(boolean success) {&#10;        this.success = success;&#10;    }&#10;&#10;    public String getMessage() {&#10;        return message;&#10;    }&#10;&#10;    public void setMessage(String message) {&#10;        this.message = message;&#10;    }&#10;&#10;    public String getToken() {&#10;        return token;&#10;    }&#10;&#10;    public void setToken(String token) {&#10;        this.token = token;&#10;    }&#10;&#10;    public int getUserId() {&#10;        return userId;&#10;    }&#10;&#10;    public void setUserId(int userId) {&#10;        this.userId = userId;&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>